!function(e){var n={};function t(o){if(n[o])return n[o].exports;var a=n[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,t),a.l=!0,a.exports}t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:o})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(t.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var a in e)t.d(o,a,function(n){return e[n]}.bind(null,a));return o},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=6)}([function(e,n,t){var o=t(7),a=0;function s(){0===a&&o.show(),a+=1}function r(){0===(a-=1)&&o.hide()}function i(e){return s(),fetch(e,{headers:{Accept:"application/json","X-Key":p()}}).catch(function(e){throw r(),e}).then(u)}function c(e){return s(),fetch(e,{method:"DELETE",headers:{Accept:"application/json","X-Key":p()}}).catch(function(e){throw r(),e}).then(u)}function l(e,n,t){s();var o={Accept:"application/json","Content-Type":"application/json"};return t||(o["X-Key"]=p()),fetch(e,{method:"POST",headers:o,body:JSON.stringify(n)}).catch(function(e){throw r(),e}).then(u)}function d(e,n){return s(),fetch(e,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json","X-Key":p()},body:JSON.stringify(n)}).catch(function(e){throw r(),e}).then(u)}function u(e){return r(),e.json().then(function(e){if("success"===e.status)return e.data;var n=new Error("API response is not success: "+e.message);throw n.jsendMessage=e.message,n})}n.upload=function(e,n){return function(e,n){return s(),fetch(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/octet-stream","X-Key":p(),"X-File-Name":n.name},body:n}).catch(function(e){throw r(),e}).then(u)}("/api/upload/"+encodeURIComponent(e),n)},n.login=function(e,n){return l("/api/auth",{username:e,password:n},!0)},n.posts=function(e){return i("/api/entries/"+encodeURIComponent(e))},n.post=function(e){return i("/api/entry/"+encodeURIComponent(e))},n.entryInfo=function(e){return i("/api/entry/"+encodeURIComponent(e)+"/info")},n.comments=function(e){return i("/api/post/"+encodeURIComponent(e)+"/comments")},n.removeComment=function(e,n){return c("/api/comment/"+encodeURIComponent(e)+"/"+encodeURIComponent(n))},n.updatePost=function(e,n){return d("/api/entry/"+encodeURIComponent(e),n)},n.savePost=function(e){return l("/api/entry",e)},n.removePost=function(e){return c("/api/entry/"+encodeURIComponent(e))},n.files=function(e){return i("/api/files/"+encodeURIComponent(e))},n.removeFile=function(e,n){return c("/api/file/"+encodeURIComponent(e)+"/"+encodeURIComponent(n))},n.users=function(){return i("/api/users")},n.user=function(e){return i("/api/user/"+encodeURIComponent(e))},n.userInfo=function(){return i("/api/user/info")},n.updateUser=function(e,n){return d("/api/user/"+encodeURIComponent(e),n)},n.saveUser=function(e){return l("/api/user",e)},n.removeUser=function(e){return c("/api/user/"+encodeURIComponent(e))},n.types=function(){return i("/api/types")},n.typeInfo=function(e){return i("/api/type/"+encodeURIComponent(e))},n.roles=function(){return i("/api/roles")},n.trash=function(){return i("/api/trash")},n.removeFromTrash=function(e){return c("/api/trash/"+encodeURIComponent(e))},n.purge=function(){return c("/api/trash")},n.restore=function(e){return d("/api/restore/"+encodeURIComponent(e))},n.config=function(){return i("/api/configs")},n.updateConfig=function(e){return d("/api/configs",e)},n.testMail=function(e){return l("/api/mail/test",e)},n.tags=function(e){return i("/api/tags/"+encodeURIComponent(e)+"/all")},n.imageSize=function(e,n){return i("/api/image/size/"+encodeURIComponent(e)+"/"+encodeURIComponent(n))},n.actions=function(e){return i("/api/actions/"+encodeURIComponent(e))},n.execute=function(e,n){return d("/api/action/"+encodeURIComponent(e)+"/"+encodeURIComponent(n))},n.analyticsTs=function(e,n,t){return i("/api/analytics/timeseries/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)+"/"+encodeURIComponent(t))},n.analyticsUsers=function(e,n,t,o,a){return i("/api/analytics/users/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)+"/"+encodeURIComponent(t)+"/"+encodeURIComponent(o)+"/"+encodeURIComponent(a))},n.analyticsPages=function(e,n,t){return i("/api/analytics/pages/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)+"/"+encodeURIComponent(t))},n.analyticsSummary=function(e,n,t){return i("/api/analytics/summary/"+encodeURIComponent(e)+"/"+encodeURIComponent(n)+"/"+encodeURIComponent(t))},n.hasKey=function(){return!(!sessionStorage.getItem("api-key")&&!localStorage.getItem("api-key"))};var p=n.apiKey=function(){var e=sessionStorage.getItem("api-key")||localStorage.getItem("api-key");if(!e)throw new Error("API key is not set");return e}},function(e,n){n.info=function(e){var n=document.getElementById("messages"),t=document.createElement("div");t.className="alert alert-success message",t.innerHTML=e,n.appendChild(t),setTimeout(function(){n.removeChild(t)},2e3)},n.error=function(e){var n=document.createElement("button");n.className="close",n.innerHTML="&times;";var t=document.createElement("span");t.innerHTML=e.toString();var o=document.getElementById("messages"),a=document.createElement("div");a.className="alert alert-danger message",a.appendChild(n),a.appendChild(t),n.addEventListener("click",function(){o.removeChild(a)},!1),o.appendChild(a),e instanceof Error&&console.error(e.stack)}},function(e,n){n.show=kontainer.create("#content")},function(e,n){e.exports=function(e){var n=[],t=[];return Object.keys(e).forEach(function(o){n.push(e[o]),t.push(o)}),Promise.all(n).then(function(e){var n={};return e.forEach(function(e,o){n[t[o]]=e}),n})}},function(e,n){e.exports=function(e,n){Object.keys(n).forEach(function(t){e[t]=n[t]})}},function(e,n){n.mixin=function(e){e.expanded=ko.observable(!1),e.expand=function(){e.expanded()?e.expanded(!1):e.expanded(!0)}}},function(e,n,t){var o,a=t(0),s=t(1),r=t(8),i=t(10),c=t(13),l=t(20),d=t(23),u=t(26),p=t(28),m=t(31),f=t(34),b=t(36);(o=new Date).setFullYear(o.getFullYear()+1),document.cookie="blog_core_admin=1; path=/; expires="+o.toUTCString(),t(40),window.formatDate=function(e){return new Date(1e3*e).toISOString().substring(0,10)};var h,v={active:ko.observable(),types:ko.observable(),load:function(){return v.types()?Promise.resolve(v.types()):a.types().then(function(e){return v.types(e),e})}};function g(){return a.hasKey()?(v.load().catch(s.error),!0):(route.go("login"),!1)}function y(){var e=localStorage.getItem("autosave");if(e){var n=JSON.parse(e);if(localStorage.removeItem("autosave"),confirm('You have unsaved entry "'+n.title+'", would you like to recover it?'))return h=n,route.go("recover"),!0}return!1}ko.applyBindings(v,document.getElementById("menu")),route(/^recover$/,function(){g()&&!y()&&(h?h.$id?route.go("entry/"+h.type+"/"+h.$id):route.go("new/"+h.type):route.go("landing"))}),route(/^config$/,function(){g()&&!y()&&(v.active("config"),f.create().catch(s.error))}),route(/^entries\/([^\/]+)/,function(e){g()&&!y()&&(v.active(e),i.create(e).catch(s.error))}),route(/^entry\/([^\/]+)\/([^\/]+)/,function(e,n){g()&&!y()&&(v.active(e),c.create(e,n,h).catch(s.error),h=void 0)}),route(/^new\/([^\/]+)/,function(e){g()&&!y()&&(v.active(e),c.create(e,null,h).catch(s.error),h=void 0)}),route(/^comments\/([^\/]+)\/([^\/]+)/,function(e,n){g()&&!y()&&(v.active(e),p.create(e,n).catch(s.error))}),route(/^trash/,function(){g()&&!y()&&(v.active("trash"),m.create().catch(s.error))}),route(/^users/,function(){g()&&!y()&&(v.active("users"),l.create().catch(s.error))}),route(/^user\/new/,function(){g()&&!y()&&(v.active("users"),d.create().catch(s.error))}),route(/^user\/([^\/]+)/,function(e){g()&&!y()&&(v.active("users"),d.create(e).catch(s.error))}),route(/^analytics/,function(){g()&&!y()&&(v.active("analytics"),b.create().catch(s.error))}),route(/^login/,function(){v.active(null),r.create().catch(s.error)}),route(/^email/,function(){g()&&!y()&&(v.active("email"),u.create().catch(s.error))}),route(/^logout/,function(){sessionStorage.removeItem("api-key"),localStorage.removeItem("api-key"),window.location="/admin"}),route(/^landing/,function(){v.active(null),v.load().then(function(e){e.length>0&&route.go("entries/"+e[0].name)}).catch(s.error)}),route(/.*/,function(){route.go(a.hasKey()?"landing":"login")}),document.body.addEventListener("click",function(e){if(e.target.href&&e.target.href.match(/#logout$/))return!!confirm("Do you want to log out?")||(e.stopPropagation(),e.preventDefault(),!1)},!1)},function(e,n){n.show=function(){document.getElementById("spinner").style.display="block"},n.hide=function(){document.getElementById("spinner").style.display="none"}},function(e,n,t){var o=t(0),a=t(2),s=t(1),r=t(9);n.create=function(){var e={username:ko.observable(""),password:ko.observable(""),remember:ko.observable(!1),errors:{username:ko.observableArray([]),password:ko.observableArray([])},login:function(n){Object.keys(e.errors).forEach(function(n){e.errors[n]([])});var t=e.username(),a=e.password();""===t?e.errors.username.push("Username is not entered."):t.match(/^[^@]+@[^@]+$/)||e.errors.username.push("Username must be an email."),""===a&&e.errors.password.push("Password is not entered.");var r=n.querySelector(".has-error input, .has-error textarea, .has-error checkbox");if(r)return r.focus(),!1;o.login(t,a).then(function(n){e.remember()?(localStorage.setItem("api-key",n.key),sessionStorage.removeItem("api-key")):(sessionStorage.setItem("api-key",n.key),localStorage.removeItem("api-key")),route.go("landing")}).catch(function(n){n.toString().match(/Invalid auth credentials/)?(e.errors.username.push("Invalid auth credentials."),e.errors.password.push("Invalid auth credentials.")):s.error(n)})}};return a.show(r,e),Promise.resolve()}},function(e,n){e.exports='<h2>Login</h2>\n\n<form data-bind="submit: login">\n    <div data-bind="errors: errors.username" class="form-group">\n        <label class="control-label" for="username">Username</label>\n        <input data-bind="textInput: username"\n            type="text" name="username" title="Username"\n            placeholder="Username" class="form-control" id="username">\n    </div>\n    <div data-bind="errors: errors.password" class="form-group">\n        <label class="control-label" for="password">Password</label>\n        <input data-bind="textInput: password"\n            type="password" name="password" title="Password"\n            placeholder="Password" class="form-control" id="password">\n    </div>\n    <div class="checkbox">\n        <label><input data-bind="checked: remember" type="checkbox"\n            name="remember" id="remember">\n            Remember me</label>\n    </div>\n    <button type="submit" class="btn btn-default">\n        <span class="glyphicon glyphicon-log-in"></span> Login</button>\n</form>\n'},function(e,n,t){var o=t(0),a=t(2),s=t(11),r=t(3),i=t(12);n.create=function(e){var n={type:e,all:ko.observable([]),count:ko.observable(10),step:ko.observable(10),comments:ko.observable(!1),create:ko.observable(!1),title:ko.observable(),loaded:ko.observable(!1),tags:ko.observable([]),tag:ko.observable(),status:ko.observable("all")};n.filtered=ko.pureComputed(function(){var e=n.tag(),t=n.status(),o=[];return n.all().forEach(function(n){var a=!e||n.tags.indexOf(e)>-1,s="all"===t||"published"===t&&n.published||"unpublished"===t&&!n.published;a&&s&&o.push(n)}),o}),n.hasMore=ko.pureComputed(function(){return n.count()<n.filtered().length}),n.showMore=function(){n.count(n.count()+n.step()),setTimeout(function(){window.scrollTo(0,document.body.scrollHeight)},50)},n.showAll=function(){n.count(n.filtered().length)},n.posts=ko.pureComputed(function(){return n.filtered().slice(0,n.count())});var t={typeInfo:o.typeInfo(e),userInfo:o.userInfo(),posts:o.posts(e),tags:o.tags(e)};return r(t).then(function(e){n.title(e.typeInfo.menu_label),n.comments(e.typeInfo.comments);var t=!1;"admin"===e.userInfo.type&&(t=!0),e.typeInfo.grants.indexOf("create")>=0&&(t=!0),n.create(t),e.tags.forEach(function(e){e.label=e.tag+" ("+e.count+")"}),e.tags.sort(function(e,n){return e.tag===n.tag?0:e.tag<n.tag?-1:1}),n.tags(e.tags),e.posts.sort(function(e,n){return n.date_updated-e.date_updated}),n.all(e.posts.map(function(n){return s.create(n,e.typeInfo,e.userInfo)})),a.show(i,n)})}},function(e,n,t){var o=t(0),a=t(4),s=t(1),r=t(5);n.create=function(e,n,t){var i={};return r.mixin(i),a(i,e),i.removable=!1,"admin"===t.type&&(i.removable=!0),n.grants.indexOf("remove_any")>=0&&(i.removable=!0),n.grants.indexOf("remove_own")>=0&&t.$id===i.author&&(i.removable=!0),i.editable=!1,"admin"===t.type&&(i.editable=!0),n.grants.indexOf("update_any")>=0&&(i.editable=!0),n.grants.indexOf("update_own")>=0&&t.$id===i.author&&(i.editable=!0),i.editLink="#entry/"+n.name+"/"+i.$id,i.commentsLink="#comments/"+n.name+"/"+i.$id,i.remove=function(){confirm('Remove the post "'+i.title+'"?')&&o.removePost(i.$id).then(function(){s.info('The post "'+i.title+'" has been removed.'),route.refresh()}).catch(s.error)},i}},function(e,n){e.exports='<h2 data-bind="text: title"></h2>\n\n<div class="bc-margin-bottom">\n    <div class="row">\n        <div class="col-md-2">\n            <div class="form-group">\n                <label for="filter-tag">Tag filter</label>\n                <select data-bind="value: tag, options: tags,\n                    optionsText: \'label\', optionsValue: \'tag\',\n                    optionsCaption: \'All tags\'"\n                    class="form-control input-sm"></select>\n            </div>\n        </div>\n        <div class="col-md-2">\n            <div class="form-group">\n                <label for="filter-status">Status filter</label>\n                <select data-bind="value: status"\n                    class="form-control input-sm">\n                    <option value="all">All</option>\n                    <option value="published">Published</option>\n                    <option value="unpublished">Not published</option>\n                </select>\n            </div>\n        </div>\n    </div>\n</div>\n\n<ul data-bind="foreach: posts" class="list-group">\n    <li class="list-group-item post-item">\n        <h4 data-bind="click: expand, text: title" class="list-group-item-heading"></h4>\n        <div class="list-group-item-text">\n            Update date: <span data-bind="text: formatDate(date_updated)"></span>\n            \x3c!-- ko if: $parent.comments() --\x3e\n                comments: <span data-bind="text: comments"></span><br>\n            \x3c!-- /ko --\x3e\n            \x3c!-- ko if: tags.length > 0 --\x3e\n                <span data-bind="text: tags.join(\', \')" class="bc-entries-tag"></span>\n            \x3c!-- /ko --\x3e\n            <div data-bind="visible: expanded" class="post-controls bc-margin-bottom-sm">\n                \x3c!-- ko if: editable --\x3e\n                    <a data-bind="attr: { href: editLink }" class="btn btn-default btn-sm" href="#">\n                        <span class="glyphicon glyphicon-edit"></span> Edit\n                    </a>\n                \x3c!-- /ko --\x3e\n                \x3c!-- ko if: $parent.comments() --\x3e\n                    <a data-bind="attr: { href: commentsLink }, css: { disabled: comments === 0 }"\n                        class="btn btn-default btn-sm" href="#">\n                        <span class="glyphicon glyphicon-comment"></span> Comments\n                    </a>\n                \x3c!-- /ko --\x3e\n                \x3c!-- ko if: removable --\x3e\n                    <a data-bind="click: remove"\n                        class="btn btn-default btn-sm" href="#">\n                        <span class="glyphicon glyphicon-remove"></span> Remove\n                    </a>\n                \x3c!-- /ko --\x3e\n            </div>\n            \x3c!-- ko if: !published --\x3e\n                <div>\n                    <span class="label label-warning">Not published</span>\n                </div>\n            \x3c!-- /ko --\x3e\n        </div>\n    </li>\n</ul>\n\n\x3c!-- ko if: posts().length === 0 --\x3e\n    <div class="alert alert-info" role="alert">\n        No entries to show.\n    </div>\n\x3c!-- /ko --\x3e\n\n<div class="bc-controls">\n    <a data-bind="click: showMore, css: { disabled: !hasMore() }" class="btn btn-default" href="#">\n        <span class="glyphicon glyphicon-list-alt"></span> Show more\n    </a>\n    <a data-bind="click: showAll, css: { disabled: !hasMore() }" class="btn btn-default" href="#">\n        <span class="glyphicon glyphicon-list-alt"></span> Show all\n    </a>\n    <a data-bind="attr: { href: \'#new/\' + type }" class="btn btn-default" href="#">\n        <span class="glyphicon glyphicon-plus"></span> Add\n    </a>\n</div>\n'},function(e,n,t){var o=t(0),a=t(14),s=t(2),r=t(17),i=t(1),c=t(18),l=t(3),d=t(19);function u(e){return"admin"===e.type?o.users():Promise.resolve([{$id:e.$id,fullname:e.fullname}])}n.create=function(e,n,t){var p={post:ko.observable(),info:ko.observable(!1),files:ko.observable(!1),modified:ko.observable(!1),hasPreview:ko.observable(!1),previewNotice:ko.observable(!1),actionNotice:ko.observable(!1),softWrap:ko.observable("100"),settings:ko.observable(!1),help:ko.observable(!1),actions:ko.observable([]),fontSize:ko.observable("14")},m=localStorage.getItem("softwrap");m&&p.softWrap(m);var f=localStorage.getItem("fontsize");return f&&p.fontSize(f),p.toggleInfo=function(){p.info(!p.info())},p.toggleFiles=function(){p.files(!p.files())},p.toggleSettings=function(){p.settings(!p.settings())},p.toggleHelp=function(){p.help(!p.help())},p.previewUrl=ko.pureComputed(function(){var e=p.post().slug();if(p.post().preview)return p.post().preview.replace(/<slug>/g,e)}),p.preview=function(e){n?p.post().submitUpdate().then(function(){p.post().slug();var e=p.previewUrl();c.show(e,function(){r.focus()})}).catch(i.error):p.previewNotice(!0)},p.execute=function(e){n?confirm("Do you want to run: "+e.label+"?")&&p.post().submitUpdate().then(function(){return o.execute(n,e.name)}).then(function(){i.info("Executed on the post: "+e.label+".")}).catch(i.error):p.actionNotice(!0)},p.leave=function(){route.go("entries/"+p.post().type())},function(e,n){return o.userInfo().then(function(t){var a={types:o.types(),users:u(t),userInfo:Promise.resolve(t),tags:o.tags(e)};return n?(a.post=o.post(n),a.files=o.files(n),a.actions=o.actions(n)):a.files=Promise.resolve([]),l(a)})}(e,n).then(function(o){function i(e){83===e.keyCode&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),p.post().submit()),73===e.keyCode&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),p.post().preview&&p.preview())}function l(e){if(p.modified()){var n="You have modifications. Leave without saving?";return(e=e||window.event)&&(e.returnValue=n),n}}if(p.post(a.create(o.userInfo,e,o.types,o.users,o.files,o.post,t)),o.actions&&(o.actions.forEach(function(e){var n=e.icon;e.textLabel=n.length>0&&n[0]===n[0].toUpperCase()}),p.actions(o.actions)),document.addEventListener("keydown",i,!1),p.autosave=function(){var e=p.post().toJS();e.$id=p.post().$id(),localStorage.setItem("autosave",JSON.stringify(e))},p.autosaveTimer=setInterval(function(){p.modified()&&p.autosave()},15e3),p.clearAutosave=function(){localStorage.removeItem("autosave")},window.addEventListener("beforeunload",l,!1),p.dispose=function(){document.removeEventListener("keydown",i,!1),window.removeEventListener("beforeunload",l,!1),c.dispose(),r.dispose(),clearTimeout(p.autosaveTimer)},route.leave=function(){return!p.modified()||!!confirm("You have modifications. Leave without saving?")&&(p.clearAutosave(),!0)},s.show(d,p),r.enable(),r.setSoftWrap(parseInt(p.softWrap(),10)),r.setFontSize(parseInt(p.fontSize(),10)),p.softWrap.subscribe(function(e){localStorage.setItem("softwrap",e),r.setSoftWrap(parseInt(e,10))}),p.fontSize.subscribe(function(e){localStorage.setItem("fontsize",e),r.setFontSize(parseInt(e,10))}),n)t?(r.begin(t.content),p.modified(!0)):r.begin(o.post.content),p.post().preview&&p.hasPreview(!0);else{t&&(r.begin(t.content),p.modified(!0)),p.info(!0);var u=document.querySelector("#post-title");u.focus(),"function"==typeof u.setSelectionRange&&u.setSelectionRange(0,u.value.length)}r.change(function(){p.modified(!0)}),p.post().change(function(){p.modified(!0)}),p.post().editor=r,p.post().parent=p,p.post().tags.subscribe(function(e){for(var n=document.getElementById("taglist");n.firstChild;)n.removeChild(n.firstChild);var t,a=[],s=e.match(/^(.+\,\s*)(\w+)$/);if(s){var r=s[1],i=s[2];t=i.length,o.tags.forEach(function(e){e.tag.substring(0,t)===i&&a.push(r+e.tag)})}else{e.match(/^\w+$/)&&(t=e.length,o.tags.forEach(function(n){n.tag.substring(0,t)===e&&a.push(n.tag)}))}a.forEach(function(e){var t=document.createElement("option");t.value=e,n.appendChild(t)})})})}},function(e,n,t){var o=t(0),a=t(1),s=t(15),r=t(16);function i(e){var n=e.match(/^(\d{4})\-(\d{2})\-(\d{2})$/);if(!n)throw new Error("Date does not match pattern: "+e);var t=new Date;return t.setUTCHours(0,0,0,0),t.setUTCFullYear(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10)),Math.floor(t.getTime()/1e3)}function c(e,n){var t=document.getElementById("post");Object.keys(e.errors).forEach(function(n){e.errors[n]([])}),function(e){""===e.title()&&e.errors.title.push("Title is not entered.");var n=e.slug();""===n?e.errors.slug.push("Slug is not entered."):n.match(/^[a-z0-9\-_]+$/)||e.errors.slug.push("Use lowercase letters, numbers, hyphen and underscore.");var t=e.date();""===t?e.published()&&e.errors.date.push("Publish date is not entered."):t.match(/^\d{4}\-\d{2}\-\d{2}$/)||e.errors.date.push("Date must be in the YYYY-MM-DD format.");var o=e.update();""===o?e.errors.update.push("Update date is not entered."):o.match(/^\d{4}\-\d{2}\-\d{2}$/)||e.errors.update.push("Update date must be in the YYYY-MM-DD format.")}(e);var s=t.querySelector(".has-error input, .has-error textarea, .has-error checkbox");return s?(t.querySelector(".bc-info .has-error input, .bc-info .has-error textarea, .bc-info .has-error checkbox")&&e.parent.info(!0),s.focus(),Promise.resolve(!1)):e.$id()?function(e,n,t){return o.updatePost(n.$id(),n.toJS()).then(function(){a.info('The entry "'+n.title()+'" has been updated.'),n.parent.clearAutosave(),"edit"===t?(n.slug_changed(!1),o.post(n.$id()).then(function(e){n.editor.content()!==e.content&&n.editor.begin(e.content),n.parent.modified(!1)}).catch(a.error)):route.go("entries/"+n.type())}).catch(l.bind(null,n))}(0,e,n):function(e,n,t){return o.savePost(n.toJS()).then(function(e){a.info('The entry "'+n.title()+'" has been saved.'),n.parent.modified(!1),n.parent.clearAutosave(),"edit"===t?route.go("entry/"+n.type()+"/"+e):route.go("entries/"+n.type())}).catch(l.bind(null,n))}(0,e,n)}function l(e,n){throw n.toString().match(/entry with the same slug exists/)?(e.errors.slug.push("Entry with the same slug exists."),e.parent.info(!0),document.querySelector(".has-error input").focus()):a.error(n),n}n.create=function(e,n,t,l,d,u,p){var m,f={$id:ko.observable(),authors:l,title:ko.observable("Untitled"),slug:ko.observable("untitled"),description:ko.observable(""),types:t,type:ko.observable(n),content_type:ko.observable("markdown"),published:ko.observable(!1),commenting:ko.observable(!0),tags:ko.observable(""),comments:ko.observable(0),author:ko.observable(),date:ko.observable(""),update:ko.observable(""),submit:function(){c(f,"edit")},save:function(){c(f,"leave")},language:ko.observable(bcLanguage),languages:s,slug_changed:ko.observable(!1),can_change_type:"admin"===e.type,can_change_author:"admin"===e.type,files:ko.observableArray(d),errors:{title:ko.observableArray([]),slug:ko.observableArray([]),content:ko.observableArray([]),date:ko.observableArray([]),update:ko.observableArray([])},toJS:function(){var e,n=f.tags().trim(),t=f.date();""!==t&&(e=i(t));var o=i(f.update());return{author:f.author(),title:f.title(),slug:f.slug(),description:f.description(),content:f.editor.content(),type:f.type(),date_published:e,date_updated:o,commenting:f.commenting(),published:f.published(),content_type:f.content_type(),tags:""===n?[]:n.split(/\, */),language:f.language()}},fromJS:function(e){if(void 0!==e.date_published){var n=new Date(1e3*e.date_published);f.date(n.toISOString().substring(0,10))}f.$id(e.$id),f.author(e.author),f.title(e.title),f.slug(e.slug),f.description(e.description||""),f.type(e.type),f.content_type(e.content_type),f.published(e.published),f.commenting(e.commenting),f.tags(e.tags.join(", ")),f.comments(e.comments),f.language(e.language),d.sort(function(e,n){return e.name===n.name?0:e.name<n.name?-1:1}),f.files(d.map(function(e){return r.create(f.slug,e)}))}};if(t.forEach(function(e){e.name===n&&(m=e)}),!m)throw new Error("Invalid type "+n);return f.preview=m.preview,u?p?(f.fromJS(p),setTimeout(function(){f.parent.autosave()},100)):f.fromJS(u):(p&&(f.fromJS(p),setTimeout(function(){f.parent.autosave()},100)),f.title.subscribe(function(e){f.slug(getSlug(e))}),f.author(e.$id),f.date((new Date).toISOString().substring(0,10))),f.can_publish=!1,"admin"===e.type&&(f.can_publish=!0),m.grants.indexOf("publish_any")>=0&&(f.can_publish=!0),m.grants.indexOf("publish_own")>=0&&f.author()===e.$id&&(f.can_publish=!0),f.can_manage_files=!1,"admin"===e.type&&(f.can_manage_files=!0),m.grants.indexOf("update_any")>=0&&m.grants.indexOf("files")>=0&&(f.can_manage_files=!0),m.grants.indexOf("update_own")>=0&&f.author()===e.$id&&m.grants.indexOf("files")>=0&&(f.can_manage_files=!0),f.update((new Date).toISOString().substring(0,10)),f.published.subscribe(function(e){e&&""===f.date()&&f.date((new Date).toISOString().substring(0,10))}),f.slug.subscribe(function(e){f.slug_changed(!0)}),f.uploadFile=function(){var e=document.getElementById("entry-file").files[0];e&&f.$id()&&o.upload(f.$id(),e).then(function(n){a.info('File "'+e.name+'" has been uploaded.'),f.files.push(r.create(f.slug,{name:e.name}));var t=document.getElementById("entry-file-wrap");t.innerHTML="",t.innerHTML='<input type="file" id="entry-file" class="form-control" placeholder="Your file">'}).catch(a.error)},f.removeFile=function(e){confirm('Remove the file "'+e.name+'"?')&&o.removeFile(f.$id(),e.name).then(function(){a.info('File "'+e.name+'" has been removed.'),f.files.remove(e)}).catch(a.error)},f.insertImage=function(e){o.imageSize(f.$id(),e.name).then(function(n){f.editor.insert('<img src="'+e.url()+'" width="'+n.width+'" height="'+n.height+'">'),f.editor.focus()},function(){f.editor.insert('<img src="'+e.url()+'">'),f.editor.focus()}).catch(a.error)},f.insertLink=function(e){f.editor.insert("["+e.name+"]("+e.url()+")"),f.editor.focus()},f.submitUpdate=function(){return c(f,"edit")},f.change=function(e){f.changeCallback=e},["author","title","slug","description","type","content_type","published","commenting","tags","language","date","update"].forEach(function(e){f[e].subscribe(function(){"function"==typeof f.changeCallback&&f.changeCallback()})}),f}},function(e,n){e.exports=[{code:"ab",name:"Abkhaz"},{code:"aa",name:"Afar"},{code:"af",name:"Afrikaans"},{code:"ak",name:"Akan"},{code:"sq",name:"Albanian"},{code:"am",name:"Amharic"},{code:"ar",name:"Arabic"},{code:"an",name:"Aragonese"},{code:"hy",name:"Armenian"},{code:"as",name:"Assamese"},{code:"av",name:"Avaric"},{code:"ae",name:"Avestan"},{code:"ay",name:"Aymara"},{code:"az",name:"Azerbaijani"},{code:"bm",name:"Bambara"},{code:"ba",name:"Bashkir"},{code:"eu",name:"Basque"},{code:"be",name:"Belarusian"},{code:"bn",name:"Bengali"},{code:"bh",name:"Bihari"},{code:"bi",name:"Bislama"},{code:"bs",name:"Bosnian"},{code:"br",name:"Breton"},{code:"bg",name:"Bulgarian"},{code:"my",name:"Burmese"},{code:"ca",name:"Catalan; Valencian"},{code:"ch",name:"Chamorro"},{code:"ce",name:"Chechen"},{code:"ny",name:"Chichewa; Chewa; Nyanja"},{code:"zh",name:"Chinese"},{code:"cv",name:"Chuvash"},{code:"kw",name:"Cornish"},{code:"co",name:"Corsican"},{code:"cr",name:"Cree"},{code:"hr",name:"Croatian"},{code:"cs",name:"Czech"},{code:"da",name:"Danish"},{code:"dv",name:"Divehi; Dhivehi; Maldivian;"},{code:"nl",name:"Dutch"},{code:"en",name:"English"},{code:"eo",name:"Esperanto"},{code:"et",name:"Estonian"},{code:"ee",name:"Ewe"},{code:"fo",name:"Faroese"},{code:"fj",name:"Fijian"},{code:"fi",name:"Finnish"},{code:"fr",name:"French"},{code:"ff",name:"Fula; Fulah; Pulaar; Pular"},{code:"gl",name:"Galician"},{code:"ka",name:"Georgian"},{code:"de",name:"German"},{code:"el",name:"Greek, Modern"},{code:"gn",name:"Guaraní"},{code:"gu",name:"Gujarati"},{code:"ht",name:"Haitian; Haitian Creole"},{code:"ha",name:"Hausa"},{code:"he",name:"Hebrew (modern)"},{code:"hz",name:"Herero"},{code:"hi",name:"Hindi"},{code:"ho",name:"Hiri Motu"},{code:"hu",name:"Hungarian"},{code:"is",name:"Icelandic"},{code:"io",name:"Ido"},{code:"ig",name:"Igbo"},{code:"id",name:"Indonesian"},{code:"ia",name:"Interlingua"},{code:"ie",name:"Interlingue"},{code:"iu",name:"Inuktitut"},{code:"ik",name:"Inupiaq"},{code:"ga",name:"Irish"},{code:"it",name:"Italian"},{code:"ja",name:"Japanese"},{code:"jv",name:"Javanese"},{code:"kl",name:"Kalaallisut, Greenlandic"},{code:"kn",name:"Kannada"},{code:"kr",name:"Kanuri"},{code:"ks",name:"Kashmiri"},{code:"kk",name:"Kazakh"},{code:"km",name:"Khmer"},{code:"ki",name:"Kikuyu, Gikuyu"},{code:"rw",name:"Kinyarwanda"},{code:"ky",name:"Kirghiz, Kyrgyz"},{code:"rn",name:"Kirundi"},{code:"kv",name:"Komi"},{code:"kg",name:"Kongo"},{code:"ko",name:"Korean"},{code:"ku",name:"Kurdish"},{code:"kj",name:"Kwanyama, Kuanyama"},{code:"lo",name:"Lao"},{code:"la",name:"Latin"},{code:"lv",name:"Latvian"},{code:"li",name:"Limburgish, Limburgan, Limburger"},{code:"ln",name:"Lingala"},{code:"lt",name:"Lithuanian"},{code:"lu",name:"Luba-Katanga"},{code:"lg",name:"Luganda"},{code:"lb",name:"Luxembourgish, Letzeburgesch"},{code:"mk",name:"Macedonian"},{code:"mg",name:"Malagasy"},{code:"ms",name:"Malay"},{code:"ml",name:"Malayalam"},{code:"mt",name:"Maltese"},{code:"gv",name:"Manx"},{code:"mr",name:"Marathi (Marāṭhī)"},{code:"mh",name:"Marshallese"},{code:"mn",name:"Mongolian"},{code:"mi",name:"Māori"},{code:"na",name:"Nauru"},{code:"nv",name:"Navajo, Navaho"},{code:"ng",name:"Ndonga"},{code:"ne",name:"Nepali"},{code:"nd",name:"North Ndebele"},{code:"se",name:"Northern Sami"},{code:"no",name:"Norwegian"},{code:"nb",name:"Norwegian Bokmål"},{code:"nn",name:"Norwegian Nynorsk"},{code:"ii",name:"Nuosu"},{code:"oc",name:"Occitan"},{code:"oj",name:"Ojibwe, Ojibwa"},{code:"cu",name:"Old Church Slavonic, Church Slavic, Church Slavonic, Old Bulgarian, Old Slavonic"},{code:"or",name:"Oriya"},{code:"om",name:"Oromo"},{code:"os",name:"Ossetian, Ossetic"},{code:"pa",name:"Panjabi, Punjabi"},{code:"ps",name:"Pashto, Pushto"},{code:"fa",name:"Persian"},{code:"pl",name:"Polish"},{code:"pt",name:"Portuguese"},{code:"pi",name:"Pāli"},{code:"qu",name:"Quechua"},{code:"ro",name:"Romanian, Moldavian, Moldovan"},{code:"rm",name:"Romansh"},{code:"ru",name:"Russian"},{code:"sm",name:"Samoan"},{code:"sg",name:"Sango"},{code:"sa",name:"Sanskrit (Saṁskṛta)"},{code:"sc",name:"Sardinian"},{code:"gd",name:"Scottish Gaelic; Gaelic"},{code:"sr",name:"Serbian"},{code:"sn",name:"Shona"},{code:"sd",name:"Sindhi"},{code:"si",name:"Sinhala, Sinhalese"},{code:"sk",name:"Slovak"},{code:"sl",name:"Slovene"},{code:"so",name:"Somali"},{code:"nr",name:"South Ndebele"},{code:"st",name:"Southern Sotho"},{code:"es",name:"Spanish; Castilian"},{code:"su",name:"Sundanese"},{code:"sw",name:"Swahili"},{code:"ss",name:"Swati"},{code:"sv",name:"Swedish"},{code:"tl",name:"Tagalog"},{code:"ty",name:"Tahitian"},{code:"tg",name:"Tajik"},{code:"ta",name:"Tamil"},{code:"tt",name:"Tatar"},{code:"te",name:"Telugu"},{code:"th",name:"Thai"},{code:"bo",name:"Tibetan Standard, Tibetan, Central"},{code:"ti",name:"Tigrinya"},{code:"to",name:"Tonga (Tonga Islands)"},{code:"ts",name:"Tsonga"},{code:"tn",name:"Tswana"},{code:"tr",name:"Turkish"},{code:"tk",name:"Turkmen"},{code:"tw",name:"Twi"},{code:"ug",name:"Uighur, Uyghur"},{code:"uk",name:"Ukrainian"},{code:"ur",name:"Urdu"},{code:"uz",name:"Uzbek"},{code:"ve",name:"Venda"},{code:"vi",name:"Vietnamese"},{code:"vo",name:"Volapük"},{code:"wa",name:"Walloon"},{code:"cy",name:"Welsh"},{code:"fy",name:"Western Frisian"},{code:"wo",name:"Wolof"},{code:"xh",name:"Xhosa"},{code:"yi",name:"Yiddish"},{code:"yo",name:"Yoruba"},{code:"za",name:"Zhuang, Chuang"}]},function(e,n,t){t(0);var o=t(4),a=(t(1),t(5));n.create=function(e,n){var t={};return o(t,n),a.mixin(t),t.url=ko.pureComputed(function(){return"/"+encodeURIComponent(e())+"/"+encodeURIComponent(t.name)}),t.image=!!t.name.match(/\.(gif|jpg|jpeg|tiff|png)$/i),t}},function(e,n){var t;n.enable=function(){(t=ace.edit("editor")).$blockScrolling=1/0,t.container.style.lineHeight=1.5,t.setOptions({maxLines:1/0,showLineNumbers:!1,wrap:!0,showPrintMargin:!1,showFoldWidgets:!1,showGutter:!1,displayIndentGuides:!1,fontSize:14,fontFamily:"monospace",useSoftTabs:!0,tabSize:2}),t.setTheme("ace/theme/github"),t.getSession().setMode("ace/mode/markdown")},n.setSoftWrap=function(e){t&&t.getSession().setWrapLimitRange(e,e)},n.setFontSize=function(e){t&&t.setOption("fontSize",e)},n.begin=function(e){t.setValue(e),t.getSession().setUndoManager(new ace.UndoManager),t.focus(),t.gotoLine(1)},n.change=function(e){t.on("change",e)},n.focus=function(){t.focus()},n.content=function(){return t.getValue()},n.insert=function(e){t&&t.insert(e)},n.setValue=function(e){t&&t.setValue(e)},n.dispose=function(){t&&(t.destroy(),t=null)}},function(e,n){var t,o,a,s=-1;function r(){return c.querySelector("iframe")}n.show=function(e,n){var d=r();d?t===e?d.contentWindow.location.reload(!0):(d.src=e,s=-1):((d=document.createElement("iframe")).src=e,c.appendChild(d),s=-1),a=document.body.scrollTop,i.style.display="none",c.style.display="block",l.style.display="block",s>0&&(document.body.scrollTop=s),t=e,o=n},n.dispose=function(){c.innerHTML="",o=null};var i=document.getElementById("main"),c=document.getElementById("preview"),l=document.getElementById("preview-controls");function d(){s=document.body.scrollTop,i.style.display="block",c.style.display="none",l.style.display="none","function"==typeof o&&o(),document.body.scrollTop=a}l.querySelector('[data-control="close"]').addEventListener("click",function(e){e.preventDefault(),d()},!1),document.addEventListener("keydown",function(e){27===e.keyCode&&d()},!1),function e(){var n=r();if(n){var t=n.contentDocument;if(t.body){var o=t.body.scrollHeight;o>n.clientHeight&&(n.style.height=o+50+"px")}}setTimeout(e,100)}()},function(e,n){e.exports='\x3c!-- ko with: post --\x3e\n    <h2 data-bind="text: title"></h2>\n    <div class="bc-margin-bottom">\n        <button data-bind="click: $root.leave" type="button"\n            class="btn btn-default" title="Leave the editor">\n            <span class="glyphicon glyphicon-chevron-left"></span>\n        </button>\n        <button data-bind="click: submit, css: { \'bc-red\': $root.modified() },\n            disable: !$root.modified()" type="button"\n            class="btn btn-default" title="Save and continue">\n            <span class="glyphicon glyphicon-floppy-disk"></span>\n        </button>\n        <button data-bind="click: $root.toggleInfo, css: { active: $root.info() }"\n            type="button" class="btn btn-default" title="Show/hide info">\n            <span class="glyphicon glyphicon-info-sign"></span>\n        </button>\n        <button data-bind="click: $root.toggleFiles, css: { active: $root.files() }"\n            type="button" class="btn btn-default">\n            <span class="glyphicon glyphicon-paperclip"></span>\n        </button>\n        <button data-bind="click: $root.toggleSettings, css: { active: $root.settings() }"\n            type="button" class="btn btn-default">\n            <span class="glyphicon glyphicon-cog"></span>\n        </button>\n        <button data-bind="click: $root.toggleHelp, css: { active: $root.help() }"\n            type="button" class="btn btn-default">\n            <span class="glyphicon glyphicon-question-sign"></span>\n        </button>\n        \x3c!-- ko if: $root.hasPreview() --\x3e\n            <button data-bind="click: $root.preview" class="btn btn-default">\n                <span class="glyphicon glyphicon-eye-open"></span>\n            </button>\n        \x3c!-- /ko --\x3e\n        \x3c!-- ko foreach: $root.actions --\x3e\n            <button data-bind="click: function() { $root.execute($data) }, attr: { title: $data.label }" class="btn btn-default">\n                \x3c!-- ko if: $data.textLabel --\x3e\n                    <strong data-bind="text: $data.icon"></strong>\n                \x3c!-- /ko --\x3e\n                \x3c!-- ko if: !$data.textLabel --\x3e\n                    <span data-bind="attr: { \'class\': \'glyphicon glyphicon-\' + $data.icon }"></span>\n                \x3c!-- /ko --\x3e\n            </button>\n        \x3c!-- /ko --\x3e\n    </div>\n    \x3c!-- ko if: published() --\x3e\n        <div class="bc-margin-bottom">\n            <div>\n                <span class="label label-danger">Published</span>\n                \x3c!-- ko if: $root.hasPreview() --\x3e\n                    &nbsp;&nbsp;<a data-bind="attr: { href: $root.previewUrl }" href="#" target="_blank">Preview\n                        <span class="glyphicon glyphicon-new-window"></span></a>\n                \x3c!-- /ko --\x3e\n            </div>\n        </div>\n    \x3c!-- /ko --\x3e\n    \x3c!-- ko if: !published() --\x3e\n        <div class="bc-margin-bottom">\n            <div>\n                <span class="label label-warning">Not published</span>\n                \x3c!-- ko if: $root.hasPreview() --\x3e\n                    &nbsp;&nbsp;<a data-bind="attr: { href: $root.previewUrl }" href="#" target="_blank">Preview\n                        <span class="glyphicon glyphicon-new-window"></span></a>\n                \x3c!-- /ko --\x3e\n            </div>\n        </div>\n    \x3c!-- /ko --\x3e\n    \x3c!-- ko if: $root.previewNotice() --\x3e\n        <div class="alert alert-warning" role="alert">\n            Previews are not available for new entries.\n            Save the entry at least once before.\n        </div>\n    \x3c!-- /ko --\x3e\n    \x3c!-- ko if: $root.actionNotice() --\x3e\n        <div class="alert alert-warning" role="alert">\n            Actions are not available for new entries.\n            Save the entry at least once before using an action.\n        </div>\n    \x3c!-- /ko --\x3e\n    <hr>\n    \x3c!-- ko if: $root.settings() --\x3e\n        <div class="row">\n            <div class="col-md-2">\n                <select data-bind="value: $root.softWrap"\n                    class="form-control bc-margin-top-sm">\n                    <option value="60">Soft wrap 60</option>\n                    <option value="70">Soft wrap 70</option>\n                    <option value="80">Soft wrap 80</option>\n                    <option value="90">Soft wrap 90</option>\n                    <option value="100">Soft wrap 100</option>\n                    <option value="110">Soft wrap 110</option>\n                    <option value="120">Soft wrap 120</option>\n                    <option value="130">Soft wrap 130</option>\n                    <option value="140">Soft wrap 140</option>\n                </select>\n            </div>\n            <div class="col-md-2">\n                <select data-bind="value: $root.fontSize"\n                    class="form-control bc-margin-top-sm">\n                    <option value="12">12</option>\n                    <option value="13">13</option>\n                    <option value="14">14</option>\n                    <option value="15">15</option>\n                    <option value="16">16</option>\n                    <option value="17">17</option>\n                    <option value="18">18</option>\n                    <option value="19">19</option>\n                    <option value="20">20</option>\n                    <option value="21">21</option>\n                    <option value="22">22</option>\n                    <option value="23">23</option>\n                    <option value="24">24</option>                    \n                </select>\n            </div>\n        </div>\n        <hr>\n    \x3c!-- /ko --\x3e\n    \x3c!-- ko if: $root.help() --\x3e\n        <h3>Shorcuts</h3>\n        <ul>\n            <li>CTRL+S - save</li>\n            <li>CTRL+I - preview (if preview is configured)</li>\n        </ul>\n        <h3>Markdown</h3>\n\n        <h4>Headings</h4>\n<pre># Heading 1\n## Heading 2\n### Heading 3\n#### Heading 4\n##### Heading 5\n###### Heading 6</pre>\n\n        <h4>Bulleted list</h4>\n\n<pre> + item1\n + item2\n + item3</pre>\n\n        <h4>Numbered list</h4>\n\n<pre> 1. item1\n 2. item2\n 3. item3</pre>\n\n<h4>Link</h4>\n\n<pre>[Text](http://example.com) or\n&lt;http://example.com&gt;</pre>\n\n<h4>Reference link</h4>\n\n<pre>[Text][link]\n[link]:http://example.com</pre>\n\n<h4>Styling</h4>\n\n<pre>*italic*\n**bold**\n~~strike-through~~</pre>\n\n<h4>Code block</h4>\n\nCode blocks use 4-space indent.\n\n<pre>    var x = 1;</pre>\n\nAlternative syntax:\n\n<pre>```language\nvar x = 1;</pre>\n\n<p>\nMore info: <a href="https://daringfireball.net/projects/markdown/syntax"\n    target="_blank">Gruber\'s Markdown <span class="glyphicon glyphicon-new-window"></span></a>\n</p>\n\n        <div>\n            <a href="#" data-bind="click: $root.toggleHelp"\n                class="btn btn-default">Close help</a>\n        </div>\n        <hr>\n    \x3c!-- /ko --\x3e\n    <form data-bind="submit: submit" autocomplete="off" id="post">\n        \x3c!-- ko if: $root.info() --\x3e\n            <div class="bc-info">\n                <div class="row">\n                    <div class="col-md-4">\n                        <div data-bind="errors: errors.title" class="form-group">\n                            <label for="post-title">Title</label>\n                            <input data-bind="textInput: title"\n                                type="text" class="form-control input-sm" id="post-title"\n                                placeholder="Title">\n                            <p class="help-block">Slug is autogenerated from the title.</p>\n                        </div>\n                    </div>\n                    <div class="col-md-4">\n                        <div data-bind="errors: errors.slug" class="form-group">\n                            <label for="post-slug">Slug</label>\n                            <input data-bind="textInput: slug"\n                                type="text" class="form-control input-sm" id="post-slug"\n                                placeholder="Slug">\n                            <p class="help-block">Modifying the slug after publishing will break links.</p>\n                        </div>\n                    </div>\n                    <div class="col-md-4">\n                        <div class="form-group">\n                            <label for="post-tags">Tags</label>\n                            <input data-bind="textInput: tags"\n                                type="text" class="form-control input-sm" id="post-tags"\n                                placeholder="Tags" list="taglist">\n                            <datalist id="taglist">\n                                <option value="node.js">\n                                <option value="javascript">\n                            </datalist>\n                            <p class="help-block">Separate multiple tags with commas.</p>\n                        </div>\n                    </div>\n                </div>\n                <div class="row">\n                    <div class="col-md-2">\n                        <div class="form-group">\n                            <label for="post-type">Type</label>\n                            <select data-bind="value: type, options: types,\n                                optionsText: \'label\', optionsValue: \'name\',\n                                attr: { disabled: !can_change_type }"\n                                class="form-control input-sm" id="post-type"></select>\n                        </div>\n                    </div>\n                    <div class="col-md-2">\n                        <div class="form-group">\n                            <label for="post-content-type">Content type</label>\n                            <select data-bind="value: content_type"\n                                class="form-control input-sm" id="post-content-type">\n                                <option value="markdown">Markdown</option>\n                                <option value="raw">Raw</option>\n                            </select>\n                        </div>\n                    </div>\n                    <div class="col-md-2">\n                        <div class="form-group">\n                            <label for="post-author">Author</label>\n                            <select data-bind="value: author, options: authors,\n                                optionsText: \'fullname\', optionsValue: \'$id\',\n                                attr: { disabled: !can_change_author }"\n                                class="form-control input-sm" id="post-author"></select>\n                        </div>\n                    </div>\n                    <div class="col-md-2">\n                        <div class="form-group">\n                            <label for="post-language">Language</label>\n                            <select data-bind="value: language, options: languages,\n                                optionsText: \'name\', optionsValue: \'code\'"\n                                class="form-control input-sm" id="post-language"></select>\n                        </div>\n                    </div>\n                    <div class="col-md-2">\n                        <div data-bind="errors: errors.date" class="form-group">\n                            <label for="post-date">Publish date</label>\n                            <input data-bind="textInput: date"\n                                type="text" class="form-control input-sm" id="post-date"\n                                placeholder="YYYY-MM-DD">\n                        </div>\n                    </div>\n                    <div class="col-md-2">\n                        <div data-bind="errors: errors.update" class="form-group">\n                            <label for="post-update">Update date</label>\n                            <input data-bind="textInput: update"\n                                type="text" class="form-control input-sm" id="post-update"\n                                placeholder="YYYY-MM-DD">\n                        </div>\n                    </div>\n                </div>\n                <div class="row">\n                    <div class="col-md-8">\n                        <div class="form-group">\n                            <label for="post-description">Description</label>\n                            <textarea\n                                data-bind="textInput: description"\n                                class="form-control input-sm" rows="2" id="post-description" placeholder="Description"></textarea>\n                            <p class="help-block">Description is used by search engines to show the page snippet.\n                                It must not contain HTML.</p>\n                        </div>\n                    </div>\n                    <div class="col-md-2">\n                        <div class="checkbox">\n                            <label><input data-bind="checked: published,\n                                attr: { disabled: !can_publish }"\n                                type="checkbox" id="post-published"> Published</label>\n                        </div>\n                    </div>\n                    <div class="col-md-2">\n                        <div class="checkbox">\n                            <label><input data-bind="checked: commenting"\n                                type="checkbox"> Commenting</label>\n                        </div>\n                    </div>\n                </div>\n                <hr>\n            </div>\n        \x3c!-- /ko --\x3e\n        \x3c!-- ko if: $root.files() --\x3e\n            \x3c!-- ko if: can_manage_files --\x3e\n                \x3c!-- ko if: !$id() --\x3e\n                    <div class="alert alert-warning" role="alert">\n                        To upload files you need to save the entry first.\n                    </div>\n                \x3c!-- /ko --\x3e\n                \x3c!-- ko if: $id() --\x3e\n                    \x3c!-- ko if: slug_changed() --\x3e\n                        <div class="alert alert-warning" role="alert">\n                            You have changed the entry slug. File management is\n                            re-enabled after saving the entry.\n                        </div>\n                    \x3c!-- /ko --\x3e\n                    \x3c!-- ko if: !slug_changed() --\x3e\n                        \x3c!-- ko if: files().length === 0 --\x3e\n                            <div class="alert alert-info" role="alert">\n                                This entry has no files.\n                            </div>\n                        \x3c!-- /ko --\x3e\n                        <div data-bind="foreach: files" class="list-group">\n                            <li class="list-group-item post-item">\n                                <div data-bind="click: expand" class="list-group-item-heading">\n                                    <span class="glyphicon glyphicon-file"></span> \x3c!-- ko text: name --\x3e\x3c!-- /ko --\x3e\n                                </div>\n                                \x3c!-- ko if: expanded() --\x3e\n                                    URL: \x3c!-- ko text: url --\x3e\x3c!-- /ko --\x3e\n                                    <div class="post-controls">\n                                        <a data-bind="click: $parent.removeFile"\n                                            class="btn btn-default btn-sm" href="#">\n                                            <span class="glyphicon glyphicon-edit"></span> Remove</a>\n                                        <a data-bind="attr: { href: url }" target="_blank"\n                                            class="btn btn-default btn-sm" href="#">\n                                            <span class="glyphicon glyphicon-eye-open"></span> View (in new tab)</a>\n                                        <a data-bind="click: $parent.insertLink"\n                                            class="btn btn-default btn-sm" href="#">\n                                            <span class="glyphicon glyphicon-pencil"></span> Insert as link</a>\n                                        \x3c!-- ko if: image --\x3e\n                                            <a data-bind="click: $parent.insertImage"\n                                                class="btn btn-default btn-sm" href="#">\n                                                <span class="glyphicon glyphicon-pencil"></span> Insert as image</a>\n                                        \x3c!-- /ko --\x3e\n                                    </div>\n                                \x3c!-- /ko --\x3e\n                            </li>\n                        </div>\n                        <div class="row bc-controls">\n                            <div class="col-sm-6">\n                                <div id="entry-file-wrap">\n                                    <input type="file" id="entry-file" class="form-control" placeholder="Your file">\n                                </div>\n                            </div>\n                            <div class="col-sm-6">\n                                <a data-bind="click: uploadFile" class="btn btn-default" href="#">\n                                    <span class="glyphicon glyphicon-upload"></span> Upload\n                                </a>\n                            </div>\n                        </div>\n                    \x3c!-- /ko --\x3e\n                \x3c!-- /ko --\x3e\n            \x3c!-- /ko --\x3e\n            \x3c!-- ko if: !can_manage_files --\x3e\n                <div class="alert alert-warning" role="alert">\n                    To upload files you need file management permissions.\n                </div>\n            \x3c!-- /ko --\x3e\n            <hr>\n        \x3c!-- /ko --\x3e\n        \x3c!-- ko if: slug_changed() && $id() --\x3e\n            <div class="alert alert-warning" role="alert">\n                You must save the entry after modifying the slug. This will\n                automatically fix images and links to files in the content.\n            </div>\n        \x3c!-- /ko --\x3e\n        <div id="editor-wrap">\n            <div id="editor"></div>\n        </div>\n    </form>\n\x3c!-- /ko --\x3e\n'},function(e,n,t){var o=t(0),a=t(2),s=t(21),r=t(22);n.create=function(){var e={users:ko.observableArray([]),permission:ko.observable(!1)};return o.userInfo().then(function(n){if("admin"===n.type)return o.users().then(function(t){e.users(t.map(function(e){var t=s.create(e);return t.editable="admin"===n.type||t.$id===n.$id,t})),e.permission(!0),a.show(r,e)});a.show(r,e)})}},function(e,n,t){var o=t(0),a=t(4),s=t(1),r=t(5);n.create=function(e){var n={editable:!1};return r.mixin(n),a(n,e),n.remove=function(){confirm("Remove the user?")&&o.userInfo().then(function(e){return o.removeUser(n.$id).then(function(){s.info('User "'+n.username+'" has been removed.'),e.$id===n.$id?(sessionStorage.removeItem("api-key"),localStorage.removeItem("api-key"),window.location="/admin"):route.refresh()})}).catch(s.error)},n}},function(e,n){e.exports='<h2>Users</h2>\n\x3c!-- ko if: !permission() --\x3e\n    <div class="alert alert-warning" role="alert">\n        You do not have permissions to manage users.\n    </div>\n\x3c!-- /ko --\x3e\n\x3c!-- ko if: permission() --\x3e\n    <ul data-bind="foreach: users" class="list-group">\n        <li class="list-group-item post-item">\n            <h4 data-bind="click: expand, text: fullname" class="list-group-item-heading"></h4>\n            <div class="list-group-item-text">\n                Type: <span data-bind="text: type"></span>,\n                username: <span data-bind="text: username"></span>\n                <div data-bind="visible: expanded" class="post-controls">\n                    <a data-bind="attr: { href: \'#user/\' + $id }, css: { disabled: !editable }"\n                        class="btn btn-default btn-sm" href="#">\n                        <span class="glyphicon glyphicon-edit"></span> Edit\n                    </a>\n                    <a data-bind="click: remove, css: { disabled: !editable }"\n                        class="btn btn-default btn-sm" href="#">\n                        <span class="glyphicon glyphicon-remove"></span> Remove\n                    </a>\n                </div>\n            </div>\n        </li>\n    </ul>\n    <a class="btn btn-default" href="#user/new">\n        <span class="glyphicon glyphicon-plus"></span> Add\n    </a>\n\x3c!-- /ko --\x3e\n'},function(e,n,t){var o=t(0),a=t(2),s=t(24),r=t(3),i=t(25);n.create=function(e){var n={user:ko.observable()},t={roles:o.roles()};return e&&(t.user=o.user(e)),r(t).then(function(t){if(n.user(s.create(t.roles,t.user)),a.show(i,n),e){var o=document.querySelector("#user-fullname");o.focus(),"function"==typeof o.setSelectionRange&&o.setSelectionRange(0,o.value.length)}})}},function(e,n,t){var o=t(0),a=t(1);function s(e,n){var t=n.toString();t.match(/Cannot remove the last admin/)?e.errors.type.push("Cannot remove the last admin."):t.match(/username exists/)?e.errors.username.push("The username exists."):a.error(n)}n.create=function(e,n){var t={username:ko.observable(""),fullname:ko.observable(""),type:ko.observable("author"),link:ko.observable(""),password:ko.observable(""),password_edit:ko.observable(!0),password_text:ko.observable(!1),error:ko.observable(""),creating:!0,roles:e,comment_notifications:ko.observable(!1),errors:{username:ko.observableArray([]),fullname:ko.observableArray([]),password:ko.observableArray([]),link:ko.observableArray([]),type:ko.observableArray([])},save:function(e){if(Object.keys(t.errors).forEach(function(e){t.errors[e]([])}),t.password_edit()){var n=t.password();""===n?t.errors.password.push("Password is not set."):n.length<6&&t.errors.password.push("Password length must be at least 6.")}var r=t.username();""===r?t.errors.username.push("Username is not set."):r.match(/^[^@]+@[^@]+$/)||t.errors.username.push("Username must be an email address."),""===t.fullname()&&t.errors.fullname.push("Full name is not set.");var i=t.link();""!==i&&(i.match(/https?:\/\//)||t.errors.link.push("Link must start with http:// or https:// prefix."));var c=e.querySelector(".has-error input, .has-error textarea, .has-error checkbox, .has-error select");return c?(c.focus(),!1):(t.$id?o.updateUser(t.$id,t.toJS()).then(function(){a.info('User "'+t.username()+'" has been updated.'),route.go("users")}).catch(s.bind(null,t)):o.saveUser(t.toJS()).then(function(){a.info('User "'+t.username()+'" has been added.'),route.go("users")}).catch(s.bind(null,t)),!1)},toJS:function(){var e={username:t.username(),fullname:t.fullname(),type:t.type(),link:t.link(),comment_notifications:t.comment_notifications()};return t.password_edit()&&(e.password=t.password()),e}};return t.password_text.subscribe(function(e){document.getElementById("user-password").type=e?"text":"password"}),n?(t.$id=n.$id,t.creating=!1,t.username(n.username),t.fullname(n.fullname),t.type(n.type),t.link(n.link),t.password_edit(!1),t.comment_notifications(n.comment_notifications)):t.fullname("Unnamed"),t}},function(e,n){e.exports='\x3c!-- ko with: user --\x3e\n    <h2 data-bind="text: fullname"></h2>\n\n    <form data-bind="submit: save" autocomplete="off">\n        <div data-bind="errors: errors.fullname" class="form-group">\n            <label for="user-fullname">Full name</label>\n            <input data-bind="value: fullname"\n                type="text" class="form-control" id="user-fullname"\n                placeholder="Full name">\n        </div>\n        <div data-bind="errors: errors.username" class="form-group">\n            <label for="user-username">Username</label>\n            <input data-bind="value: username"\n                type="text" class="form-control" id="user-username"\n                placeholder="Username">\n        </div>\n        <div data-bind="errors: errors.type" class="form-group">\n            <label for="user-type">Type</label>\n            <select data-bind="value: type, options: roles,\n                optionsText: \'label\', optionsValue: \'name\'"\n                class="form-control" id="user-type"></select>\n        </div>\n        <div data-bind="errors: errors.link" class="form-group">\n            <label for="user-link">Link</label>\n            <input data-bind="value: link"\n                type="text" class="form-control" id="user-link"\n                placeholder="Link">\n        </div>\n        <div class="checkbox">\n            <label><input data-bind="checked: comment_notifications" type="checkbox">\n                Comment notifications</label>\n        </div>\n        <div class="checkbox">\n            <label><input data-bind="checked: password_edit, disable: creating" type="checkbox">\n                Edit password</label>\n        </div>\n        <div data-bind="visible: password_edit, errors: errors.password" class="form-group">\n            <label for="user-password">New password</label>\n            <input data-bind="value: password"\n                type="password" class="form-control" id="user-password"\n                placeholder="Password">\n            <div class="checkbox">\n                <label><input data-bind="checked: password_text" type="checkbox">\n                    Show text</label>\n            </div>\n        </div>\n        <button type="submit" class="btn btn-default">\n            <span class="glyphicon glyphicon-ok"></span> Save\n        </button>\n        <a class="btn btn-default" href="#users">\n            <span class="glyphicon glyphicon-arrow-left"></span> Cancel\n        </a>\n    </form>\n\x3c!-- /ko --\x3e\n'},function(e,n,t){var o=t(0),a=t(2),s=t(1),r=(t(3),t(27));function i(e){var n={};return Object.keys(e).forEach(function(t){n[t]=e[t]()}),n}n.create=function(e){var n={email:ko.observable(),permission:ko.observable(!1),editing:ko.observable(!1),smtp:ko.observable({}),form:{enabled:ko.observable(!1),host:ko.observable(""),user:ko.observable(""),password:ko.observable(""),auth:ko.observable("login"),security:ko.observable("none"),from:ko.observable("admin@example.com"),subject:ko.observable("Test mail"),body:ko.observable("Test mail body")},errors:{host:ko.observableArray([]),user:ko.observableArray([]),password:ko.observableArray([]),from:ko.observableArray([]),subject:ko.observableArray([]),body:ko.observableArray([])},error:ko.observable(),info:ko.observable(),password_text:ko.observable(!1)};function t(){Object.keys(n.errors).forEach(function(e){n.errors[e]([])})}function c(){var e=n.form;e.host().match(/^\s*$/)&&n.errors.host.push("SMTP host name must be set."),"login"===e.auth()&&(e.user().match(/^\s*$/)&&n.errors.user.push("SMTP user must be set for SMTP auth."),e.password().match(/^\s*$/)&&n.errors.password.push("SMTP password must be set for SMTP auth.")),e.from().match(/^\s*$/)?n.errors.from.push("Notification sender mail must be set."):e.from().match(/^[^@]+@[^@]+$/)||n.errors.from.push("Notification sender mail must be a valid mail address.")}function l(e){var n=e.querySelector(".has-error input, .has-error textarea, .has-error checkbox, .has-error select");return!n||(n.focus(),!1)}return n.save=function(e){if(t(),c(),!l(e))return!1;var a=i(n.form);o.updateConfig(function(e){return[{name:"smtp_enabled",value:e.enabled},{name:"smtp_host",value:e.host},{name:"smtp_user",value:e.user},{name:"smtp_password",value:e.password},{name:"smtp_auth",value:e.auth},{name:"smtp_security",value:e.security},{name:"smtp_from",value:e.from}]}(a)).then(function(){n.smtp(a),s.info("Mailing system parameters have been updated."),route.refresh()}).catch(s.error)},n.edit=function(){n.editing(!0)},n.test=function(){if(n.info(void 0),n.error(void 0),t(),c(),function(){var e=n.form;e.subject().match(/^\s*$/)&&n.errors.subject.push("Test mail subject must be set.");e.body().match(/^\s*$/)&&n.errors.body.push("Test mail body must be set.")}(),!l(document.getElementById("smtp-config")))return!1;var e=i(n.form);o.testMail(e).then(function(){n.info("Test mail sent successfully.")}).catch(function(e){n.error("Mail testing failed: "+(e.jsendMessage?e.jsendMessage:e.toString()))})},n.cancel=function(){route.refresh()},o.userInfo().then(function(e){if("admin"===e.type)return o.config().then(function(e){var t=function(e){var n={};return e.forEach(function(e){n[e.name]=e.value}),{enabled:n.smtp_enabled,host:n.smtp_host,user:n.smtp_user,password:n.smtp_password,auth:n.smtp_auth,security:n.smtp_security,from:n.smtp_from}}(e);n.smtp(t),function(e,n){Object.keys(e).forEach(function(t){n[t](e[t])})}(t,n.form),n.permission(!0),a.show(r,n)});a.show(r,n)})}},function(e,n){e.exports='<h2>Email settings</h2>\n\x3c!-- ko if: !permission() --\x3e\n    <div class="alert alert-warning" role="alert">\n        You do not have permissions to edit email settings.\n    </div>\n\x3c!-- /ko --\x3e\n\x3c!-- ko if: permission() --\x3e\n    \x3c!-- ko with: smtp --\x3e\n        <div class="row bc-margin-top">\n            <div class="col-md-2 col-sm-3 col-xs-4 text-right">\n                <strong>Enabled</strong></div>\n            <div data-bind="text: (enabled ? \'yes\' : \'no\')"\n                class="col-md-4 col-sm-5 col-xs-8"></div>\n        </div>\n        <div class="row">\n            <div class="col-md-2 col-sm-3 col-xs-4 text-right">\n                <strong>SMTP host</strong></div>\n            <div data-bind="text: host"\n                class="col-md-4 col-sm-5 col-xs-8"></div>\n        </div>\n        <div class="row">\n            <div class="col-md-2 col-sm-3 col-xs-4 text-right">\n                <strong>SMTP auth</strong></div>\n            <div data-bind="text: auth"\n                class="col-md-4 col-sm-5 col-xs-8"></div>\n        </div>\n        \x3c!-- ko if: auth === \'login\' --\x3e\n            <div class="row">\n                <div class="col-md-2 col-sm-3 col-xs-4 text-right">\n                    <strong>SMTP user</strong></div>\n                <div data-bind="text: (user === \'\' ? \'not set\' : user)"\n                    class="col-md-4 col-sm-5 col-xs-8"></div>\n            </div>\n            <div class="row">\n                <div class="col-md-2 col-sm-3 col-xs-4 text-right">\n                    <strong>SMTP password</strong></div>\n                <div data-bind="text: (password === \'\' ? \'not set\' : \'not shown\')"\n                    class="col-md-4 col-sm-5 col-xs-8"></div>\n            </div>\n        \x3c!-- /ko --\x3e\n        <div class="row">\n            <div class="col-md-2 col-sm-3 col-xs-4 text-right">\n                <strong>SMTP security</strong></div>\n            <div data-bind="text: security"\n                class="col-md-4 col-sm-5 col-xs-8"></div>\n        </div>\n        <div class="row">\n            <div class="col-md-2 col-sm-3 col-xs-4 text-right">\n                <strong>SMTP from</strong></div>\n            <div data-bind="text: from"\n                class="col-md-4 col-sm-5 col-xs-8"></div>\n        </div>\n    \x3c!-- /ko --\x3e\n    <div class="row bc-margin-top">\n        <div class="col-md-4 col-sm-5 col-xs-8 col-md-offset-2 col-sm-offset-3 col-xs-offset-4">\n            <a href="#" data-bind="click: edit" class="btn btn-default">\n                <span class="glyphicon glyphicon-pencil"></span> Edit</a>\n        </div>\n    </div>\n    \x3c!-- ko if: editing() --\x3e\n        <hr>\n        <form data-bind="submit: save" autocomplete="off" id="smtp-config">\n            <div class="checkbox">\n                <label><input data-bind="checked: form.enabled" type="checkbox">\n                    Mail system enabled</label>\n            </div>\n            <div data-bind="errors: errors.host" class="form-group">\n                <label for="smtp-host">SMTP host</label>\n                <input data-bind="textInput: form.host"\n                    type="text" class="form-control" id="smtp-host"\n                    placeholder="SMTP server hostname">\n            </div>\n            <div class="form-group">\n                <label for="smtp-auth">SMTP authentication method</label>\n                <select data-bind="value: form.auth" id="smtp-auth"\n                    class="form-control">\n                    <option value="plain">Plain</option>\n                    <option value="login">Login</option>\n                </select>\n            </div>\n            <div data-bind="errors: errors.user" class="form-group">\n                <label for="smtp-user">SMTP user</label>\n                <input data-bind="textInput: form.user,\n                        disable: form.auth() === \'plain\'"\n                    type="text" class="form-control" id="smtp-user"\n                    placeholder="SMTP server user">\n            </div>\n            <div data-bind="errors: errors.password" class="form-group">\n                <label for="smtp-password">SMTP password</label>\n                <input data-bind="textInput: form.password,\n                        disable: form.auth() === \'plain\',\n                        attr: { type: password_text() ? \'text\' : \'password\' }"\n                    type="password" class="form-control" id="smtp-password"\n                    placeholder="SMTP server password">\n            </div>\n            <div class="checkbox">\n                <label><input data-bind="checked: password_text" type="checkbox">\n                    Show text</label>\n            </div>\n            <div class="form-group">\n                <label for="smtp-security">SMTP security</label>\n                <select data-bind="value: form.security" id="smtp-security"\n                    class="form-control">\n                    <option value="none">None</option>\n                    <option value="ssl">SSL</option>\n                    <option value="tls">TLS</option>\n                    <option value="starttls">STARTTLS</option>\n                </select>\n            </div>\n            <div data-bind="errors: errors.from" class="form-group">\n                <label for="smtp-from">Notification sender email (From)</label>\n                <input data-bind="textInput: form.from"\n                    type="text" class="form-control" id="smtp-form"\n                    placeholder="Mail sender address">\n            </div>\n            <div class="alert alert-info" role="alert">\n                New SMTP settings should be tested before saving. The\n                test email will be sent to the current user\'s mail address.\n            </div>\n            \x3c!-- ko if: !!error() --\x3e\n                <div data-bind="text: error" class="alert alert-danger" role="alert"></div>\n            \x3c!-- /ko --\x3e\n            \x3c!-- ko if: !!info() --\x3e\n                <div data-bind="text: info" class="alert alert-success" role="alert"></div>\n            \x3c!-- /ko --\x3e\n            <div data-bind="errors: errors.subject" class="form-group">\n                <label for="smtp-subject">Test mail subject</label>\n                <input data-bind="textInput: form.subject"\n                    type="text" class="form-control" id="smtp-subject"\n                    placeholder="Test mail subject">\n            </div>\n            <div data-bind="errors: errors.body" class="form-group">\n                <label for="smtp-body">Test mail body</label>\n                <textarea data-bind="textInput: form.body"\n                    placeholder="Test mail body" rows="3"\n                    class="form-control" id="smtp-body"></textarea>\n            </div>\n            <button type="submit" class="btn btn-default">\n                <span class="glyphicon glyphicon-ok"></span> Save\n            </button>\n            <a data-bind="click: test" class="btn btn-default" href="#">\n                <span class="glyphicon glyphicon-envelope"></span> Test</a>\n            <a data-bind="click: cancel" class="btn btn-default" href="#">\n                <span class="glyphicon glyphicon-remove"></span> Cancel</a>\n        </form>\n    \x3c!-- /ko --\x3e\n\x3c!-- /ko --\x3e\n'},function(e,n,t){var o=t(0),a=t(2),s=t(3),r=t(29),i=t(30);n.create=function(e,n){var t={title:ko.observable(),comments:ko.observable([])},c={entryInfo:o.entryInfo(n),userInfo:o.userInfo(n),typeInfo:o.typeInfo(e),comments:o.comments(n)};function l(e){var n=[];return function e(n,t,o){n.forEach(function(n){n.depth=o,t.push(n),e(n.replies,t,o+1)})}(e,n,0),n}return s(c).then(function(e){t.title(e.entryInfo.title),t.comments(l(e.comments).map(function(n){return r.create(n,e.userInfo,e.entryInfo,e.typeInfo)})),a.show(i,t)})}},function(e,n,t){var o=t(0),a=t(4),s=t(1);n.create=function(e,n,t,r){var i={};return a(i,e),i.removable=!1,"admin"===n.type&&(i.removable=!0),r.grants.indexOf("update_any")>=0&&(i.removable=!0),r.grants.indexOf("update_own")>=0&&t.author===n.$id&&(i.removable=!0),i.remove=function(){confirm("Remove the comment?")&&o.removeComment(t.$id,i.$id).then(function(){s.info("The comment has been removed."),route.refresh()}).catch(s.error)},i}},function(e,n){e.exports='<h2 data-bind="text: title"></h2>\n<h3>Comments</h3>\n<ul data-bind="foreach: comments" class="list-group">\n    <li data-bind="style: { \'padding-left\': (15 * (depth + 1)) + \'px\' }"\n        class="list-group-item post-item">\n        <h4 data-bind="text: author" class="list-group-item-heading"></h4>\n        <div class="list-group-item-text">\n            Date: <span data-bind="text: formatDate(date)"></span>\n            <div class="post-controls">\n                <div class="panel panel-default">\n                    <div data-bind="text: content" class="panel-body"></div>\n                </div>\n                \x3c!-- ko if: removable --\x3e\n                    <a data-bind="click: remove" class="btn btn-default btn-sm" href="#">\n                        <span class="glyphicon glyphicon-remove"></span> Remove\n                    </a>\n                \x3c!-- /ko --\x3e\n            </div>\n        </div>\n    </li>\n</ul>\n\x3c!-- ko if: comments().length === 0 --\x3e\n    <div class="alert alert-info" role="alert">\n        This entry has no comments.\n    </div>\n\x3c!-- /ko --\x3e\n'},function(e,n,t){var o=t(0),a=t(2),s=t(1),r=t(32),i=t(33);n.create=function(){var e={items:ko.observableArray([]),purge:function(){confirm("Purge trash?")&&o.purge().then(function(){s.info("Trash is purged."),route.refresh()}).catch(s.error)}};return o.trash().then(function(n){e.items(n.map(function(e){return r.create(e)})),a.show(i,e)})}},function(e,n,t){var o=t(0),a=t(4),s=t(1),r=t(5);n.create=function(e){var n={};return r.mixin(n),a(n,e),n.remove=function(){confirm("Remove the entry from trash?")&&o.removeFromTrash(n.$id).then(function(){s.info('Item "'+n.title+'" has been removed.'),route.refresh()}).catch(s.error)},n.restore=function(){o.restore(n.$id).then(function(){s.info('Item "'+n.title+'" has been restored.'),route.refresh()}).catch(s.error)},n}},function(e,n){e.exports='<h2>Trash</h2>\n\x3c!-- ko if: items().length === 0 --\x3e\n    <div class="alert alert-info" role="alert">\n        Trash has no entries.\n    </div>\n\x3c!-- /ko --\x3e\n<ul data-bind="foreach: items" class="list-group">\n    <li class="list-group-item post-item">\n        <h4 data-bind="click: expand, text: title" class="list-group-item-heading"></h4>\n        <div class="list-group-item-text">\n            Type: <span data-bind="text: type"></span>\n            <div data-bind="visible: expanded" class="post-controls">\n                <a data-bind="click: remove" class="btn btn-default btn-sm" href="#">\n                    <span class="glyphicon glyphicon-remove"></span> Remove\n                </a>\n                <a data-bind="click: restore" class="btn btn-default btn-sm" href="#">\n                    <span class="glyphicon glyphicon-floppy-disk"></span> Restore\n                </a>\n            </div>\n        </div>\n    </li>\n</ul>\n<a data-bind="click: purge" class="btn btn-default" href="#">\n    <span class="glyphicon glyphicon-remove"></span> Purge trash\n</a>\n'},function(e,n,t){var o=t(0),a=t(2),s=t(1),r=(t(3),t(35));n.create=function(e){var n={permission:ko.observable(!1),editing:ko.observable(!1),config:ko.observable({}),form:{site:ko.observable(""),title:ko.observable("")},errors:{site:ko.observableArray([]),title:ko.observableArray([])}};return n.save=function(e){if(Object.keys(n.errors).forEach(function(e){n.errors[e]([])}),function(){var e=n.form;""===e.site()?n.errors.site.push("Site base URL must be set."):(e.site().match(/^https?:\/\//)||n.errors.site.push("Site base URL must start with http:// or https://."),e.site().match(/\/$/)&&n.errors.site.push("Site base URL must not end with /."))}(),!function(e){var n=e.querySelector(".has-error input, .has-error textarea, .has-error checkbox, .has-error select");if(n)return n.focus(),!1;return!0}(e))return!1;var t=function(e){var n={};return Object.keys(e).forEach(function(t){n[t]=e[t]()}),n}(n.form);o.updateConfig(function(e){return[{name:"site",value:e.site},{name:"title",value:e.title}]}(t)).then(function(){n.config(t),s.info("Configuration updated."),route.refresh()}).catch(s.error)},n.edit=function(){n.editing(!0)},n.cancel=function(){route.refresh()},o.userInfo().then(function(e){if("admin"===e.type)return o.config().then(function(e){var t=function(e){var n={};return e.forEach(function(e){n[e.name]=e.value}),{site:n.site,title:n.title}}(e);n.config(t),function(e,n){Object.keys(e).forEach(function(t){n[t](e[t])})}(t,n.form),n.permission(!0),a.show(r,n)});a.show(r,n)})}},function(e,n){e.exports='<h2>Configuration</h2>\n\x3c!-- ko if: !permission() --\x3e\n    <div class="alert alert-warning" role="alert">\n        You do not have permissions to edit configuration.\n    </div>\n\x3c!-- /ko --\x3e\n\x3c!-- ko if: permission() --\x3e\n    \x3c!-- ko with: config --\x3e\n        <div class="row">\n            <div class="col-md-2 col-sm-3 col-xs-4 text-right">\n                <strong>Site base URL</strong></div>\n            <div data-bind="text: site"\n                class="col-md-4 col-sm-5 col-xs-8"></div>\n        </div>\n        <div class="row">\n            <div class="col-md-2 col-sm-3 col-xs-4 text-right">\n                <strong>Title</strong></div>\n            <div data-bind="text: title"\n                class="col-md-4 col-sm-5 col-xs-8"></div>\n        </div>\n    \x3c!-- /ko --\x3e\n    <div class="row bc-margin-top">\n        <div class="col-md-4 col-sm-5 col-xs-8 col-md-offset-2 col-sm-offset-3 col-xs-offset-4">\n            <a href="#" data-bind="click: edit" class="btn btn-default">\n                <span class="glyphicon glyphicon-pencil"></span> Edit</a>\n        </div>\n    </div>\n    \x3c!-- ko if: editing() --\x3e\n        <hr>\n        <form data-bind="submit: save" autocomplete="off" id="config-form">\n            <div data-bind="errors: errors.site" class="form-group">\n                <label for="config-site">Site base URL</label>\n                <input data-bind="textInput: form.site"\n                    type="text" class="form-control" id="config-site"\n                    placeholder="Site base URL">\n            </div>\n            <div class="form-group">\n                <label for="config-title">Title</label>\n                <input data-bind="textInput: form.title"\n                    type="text" class="form-control" id="config-title"\n                    placeholder="Site title">\n            </div>\n            <button type="submit" class="btn btn-default">\n                <span class="glyphicon glyphicon-ok"></span> Save\n            </button>\n            <a data-bind="click: cancel" class="btn btn-default" href="#">\n                <span class="glyphicon glyphicon-remove"></span> Cancel</a>\n        </form>\n    \x3c!-- /ko --\x3e\n\x3c!-- /ko --\x3e\n'},function(e,n,t){var o=t(0),a=t(2),s=(t(3),t(37)),r=t(1),i=t(38);t(39);n.create=function(){var e=new Date;e.setUTCFullYear(2018,11,1);var n=new Date;n.setUTCDate(1);for(var t=[];t.push(e.toISOString().substring(0,7)),!(e.getTime()>=n);)e.setUTCMonth(e.getUTCMonth()+1);var c={durations:["0","5","10","15","20","30","60","180","360"],months:t,startMonth:ko.observable(n.toISOString().substring(0,7)),endMonth:ko.observable(e.toISOString().substring(0,7)),duration:ko.observable("0"),results:{summary:{user_count:ko.observable(0),session_count:ko.observable(0),pageview_count:ko.observable(0)},timeseries:{users:ko.observable([]),sessions:ko.observable([]),pageviews:ko.observable([])},pages:ko.observable([])},load:function(){var e=c.startMonth(),n=c.endMonth(),t=parseInt(c.duration(),10);o.analyticsTs(e,n,t).then(function(e){c.results.timeseries.users(e.users.map(function(e){return e.count})),c.results.timeseries.sessions(e.sessions.map(function(e){return e.count})),c.results.timeseries.pageviews(e.pageviews.map(function(e){return e.count}))}).then(function(){return c.results.pages([]),o.analyticsPages(e,n,t).then(function(e){c.results.pages(e)})}).then(function(){return o.analyticsSummary(e,n,t).then(function(e){c.results.summary.user_count(e.user_count),c.results.summary.session_count(e.session_count),c.results.summary.pageview_count(e.pageview_count)})}).catch(function(e){r.error(e)})}};return c.results.timeseries.users.subscribe(function(){setTimeout(function(){i.draw("analytics-chart-users")},100)}),c.results.timeseries.sessions.subscribe(function(){setTimeout(function(){i.draw("analytics-chart-sessions")},100)}),c.results.timeseries.pageviews.subscribe(function(){setTimeout(function(){i.draw("analytics-chart-pageviews")},100)}),c.load(),Promise.resolve().then(function(){a.show(s,c)})}},function(e,n){e.exports='<h2>Reader analytics</h2>\n<div class="row">\n    <div class="col-md-2">\n        <div class="form-group">\n            <label for="analytics-start">Start month</label>\n            <select data-bind="value: $root.startMonth, options: $root.months"\n                id="analytics-start"\n                class="form-control bc-margin-top-sm">\n            </select>\n        </div>\n    </div>\n    <div class="col-md-2">\n        <div class="form-group">\n            <label for="analytics-end">End month</label>\n            <select data-bind="value: $root.endMonth, options: $root.months"\n                id="analytics-end"\n                class="form-control bc-margin-top-sm">\n            </select>\n        </div>\n    </div>\n    <div class="col-md-2">\n        <div class="form-group">\n            <label for="analytics-duration">Duration</label>\n            <select data-bind="value: $root.duration, options: $root.durations"\n                id="analytics-duration"\n                class="form-control bc-margin-top-sm">\n            </select>\n            <span class="help-block">\n                Pixel-based tracking will not track page view duration. Session duration\n                in that case will be calculated as a difference between the first and the last page visit.\n                Sessions with a single pageview will have duration 0.\n            </span>\n        </div>\n    </div>\n</div>\n<h3>Summary</h3>\n<div class="bc-margin-bottom">\n    <ul>\n        <li>Number of unique users: <span data-bind="text: $root.results.summary.user_count"></span></li>\n        <li>Number of sessions: <span data-bind="text: $root.results.summary.session_count"></span></li>\n        <li>Number of pageviews: <span data-bind="text: $root.results.summary.pageview_count"></span></li>\n    </ul>\n</div>\n<div class="row bc-margin-bottom">\n    <div class="col-md-4">\n        <div class="bc-margin-bottom-sm"><strong>Unique users:</strong></div>\n        <canvas class="chart" id="analytics-chart-users"\n            data-bind="attr: { \'data-values\': $root.results.timeseries.users().join(\',\') }"></canvas>\n    </div>\n    <div class="col-md-4">\n        <div class="bc-margin-bottom-sm"><strong>Sessions:</strong></div>\n        <canvas class="chart" id="analytics-chart-sessions"\n            data-bind="attr: { \'data-values\': $root.results.timeseries.sessions().join(\',\') }"></canvas>\n    </div>\n    <div class="col-md-4">\n        <div class="bc-margin-bottom-sm"><strong>Pageviews:</strong></div>\n        <canvas class="chart" id="analytics-chart-pageviews"\n            data-bind="attr: { \'data-values\': $root.results.timeseries.pageviews().join(\',\') }"></canvas>\n    </div>\n</div>\n<div class="row bc-margin-bottom">\n    <div class="col-md-12">\n        <a data-bind="click: $root.load" class="btn btn-default" href="#">\n            <span class="glyphicon glyphicon-refresh"></span> Refresh</a>\n    </div>\n</div>\n<h3>Top pages</h3>\n<table class="table table-striped table-condensed">\n    <thead>\n        <tr><th>Page</th><th class="text-right">View count</th></tr>\n    </thead>\n    <tbody>\n        \x3c!-- ko foreach: $root.results.pages --\x3e\n            <tr>\n                <td><a href="#" data-bind="text: title, attr: { href: location }" target="_blank"></a></td>\n                <td data-bind="text: count" class="text-right"></td>\n            </tr>\n        \x3c!-- /ko --\x3e\n    </tbody>\n</table>\n'},function(e,n){function t(e){var n=e.getAttribute("data-values");return""===n?data=[]:n&&(data=n.split(",").map(function(e){return parseFloat(e)})),data}function o(e){var n=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY;e.forEach(function(e){e<n&&(n=e),e>t&&(t=e)});var o=Math.abs(t-n);return{min:n,max:t,scale:o,apply:function(e){return(e-n)/o}}}n.draw=function(e){function n(){var a=document.getElementById(e);a?function(e,n){window.requestAnimationFrame(function(){e.width=Math.floor(e.offsetWidth),e.height=Math.floor(e.offsetHeight);var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.imageSmoothingEnabled=!0,function(e,n,t){var a=e.canvas,s=a.height,r=a.width,i=function(e){var n=o(e);return e.map(function(e){return 1-n.apply(e)})}(t),c=s-2*n,l=(r-2*n)/i.length,d=o(t),u=i[0];function p(e){return n+e*c}if(e.save(),e.lineWidth=1,e.strokeStyle="#999",e.setLineDash([2]),d.min<0&&d.max>0){var m=Math.floor(p(1-d.apply(0)))+.5;e.beginPath(),e.moveTo(n,m),e.lineTo(r-n,m),e.stroke()}var f=n+c+.5;e.beginPath(),e.moveTo(n,f),e.lineTo(r-n,f),e.stroke();var b=n+.5;e.beginPath(),e.moveTo(n,b),e.lineTo(r-n,b),e.stroke(),e.restore(),e.beginPath(),e.strokeStyle="#5cb85c",e.lineWidth=2,e.lineJoin="round",e.moveTo(n,p(u)),i.forEach(function(t,o){o>0&&e.lineTo(n+o*l,p(t))}),e.stroke(),e.font="14px Arial",e.fillText(d.max.toFixed(2),n,20),e.fillText(d.min.toFixed(2),n,s-10)}(t,0,n)})}(a,t(a)):window.removeEventListener("resize",n)}var a=document.getElementById(e);a&&a.dataset.controlled?n():(a.dataset.controlled=!0,window.addEventListener("resize",n),n())}},function(e,n){n.create=function(e){return{user_id:e.user_id,timestamp:e.timestamp,duration:e.duration,datetime:new Date(1e3*e.timestamp).toISOString(),session_count:e.session_count}}},function(e,n){function t(e,n){var t=ko.unwrap(n());if(t.length>0){var o=e.querySelector(".ko-input-error");if(!o){e.className.match(/has\-error/)||(e.className=e.className+" has-error"),(o=document.createElement("span")).className="help-block ko-input-error";var a=e.querySelector(".checkbox");a||(a=e.querySelector(".form-control")),a.parentNode.appendChild(o)}o.innerHTML=t.join(" ")}else{e.className=e.className.replace(/has\-error/,""),e.className=e.className.replace(/\s+/," ");var s=e.querySelector(".ko-input-error");s&&s.parentNode.removeChild(s)}}ko.bindingHandlers.errors={init:function(e,n){t(e,n)},update:function(e,n,o){t(e,n)}}}]);
//# sourceMappingURL=admin.min.js.map