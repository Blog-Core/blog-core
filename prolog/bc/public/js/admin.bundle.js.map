{"version":3,"file":"bundle.js","sources":["/home/raivo/blog-core/admin/node_modules/browserify/node_modules/browser-pack/_prelude.js","/home/raivo/blog-core/admin/admin.js","/home/raivo/blog-core/admin/hex.js","/home/raivo/blog-core/admin/api.js","/home/raivo/blog-core/admin/components/menu.js","/home/raivo/blog-core/admin/components/login.js","/home/raivo/blog-core/admin/components/posts.js","/home/raivo/blog-core/admin/components/post.js","/home/raivo/blog-core/admin/components/users.js","/home/raivo/blog-core/admin/components/user.js","/home/raivo/blog-core/admin/components/comments.js","/home/raivo/blog-core/admin/components/directory.js","/home/raivo/blog-core/admin/components/file.js","/home/raivo/blog-core/admin/xhr.js","/home/raivo/blog-core/admin/message.js","/home/raivo/blog-core/admin/validate.js","/home/raivo/blog-core/admin/vm/posts_item.js","/home/raivo/blog-core/admin/vm/post.js","/home/raivo/blog-core/admin/vm/users_item.js","/home/raivo/blog-core/admin/focus.js","/home/raivo/blog-core/admin/vm/user.js","/home/raivo/blog-core/admin/vm/comments_item.js","/home/raivo/blog-core/admin/path.js","/home/raivo/blog-core/admin/vm/directory_item.js","/home/raivo/blog-core/admin/spin.js","/home/raivo/blog-core/admin/assign.js","/home/raivo/blog-core/admin/vm/expandable.js","/home/raivo/blog-core/admin/languages.js"],"names":["hex","require","api","window","formatDate","ts","Date","toISOString","substring","ko","subscribable","fn","trimmed","computed","read","this","trim","write","value","valueHasMutated","owner","model","component","observable","params","menu","active","show","name","applyBindings","route","type","id","go","directory","file","sessionStorage","removeItem","hasKey","exports","string","i","length","charCodeAt","toString","String","fromCharCode","parseInt","substr","jsendAuth","options","headers","apiKey","jsend","xhr","then","response","json","JSON","parse","status","data","Error","message","login","username","password","method","url","stringify","Content-Type","posts","X-Key","post","encodeURIComponent","entryInfo","comments","removeComment","updatePost","savePost","removePost","createDirectory","subdirectory","removeDirectory","removeFile","users","user","userInfo","updateUser","saveUser","removeUser","getItem","key","components","register","viewModel","createViewModel","template","page","form","validate","clear","error","match","hasError","res","setItem","formError","all","count","step","hasMore","pureComputed","showMore","setTimeout","scrollTo","document","body","scrollHeight","showAll","slice","tasks","Promise","info","sort","post1","post2","date_updated","map","posts_item","create","editable","$id","author","postData","editor","getElementById","style","height","title","querySelector","focus","setSelectionRange","observableArray","users_item","userData","comments_item","path","decode","entries","parent","upload","progress","submit","sub","join","cancel","files","reader","FileReader","onload","XMLHttpRequest","addEventListener","complete","failed","aborted","open","setRequestHeader","send","Uint8Array","result","readAsArrayBuffer","e","lengthComputable","Math","round","loaded","total","refresh","remove","confirm","list","directory_item","compare","size","date","modified","spin","module","resolve","reject","req","Object","keys","forEach","onreadystatechange","readyState","hide","responseText","text","messages","createElement","className","innerHTML","appendChild","removeChild","err","button","console","stack","errors","querySelectorAll","item","parentNode","classList","elem","add","insertBefore","assign","expandable","mixin","findAuthor","authors","isoDateToUnix","setUTCHours","setUTCFullYear","floor","getTime","validatePost","slug","content","published","update","submitPost","edit","toJS","scroll","languages","description","content_type","commenting","tags","author_selectable","save","language","bcLanguage","date_published","split","d","subscribe","getSlug","selector","el","fullname","link","password_edit","password_text","creating","my_type","js","comment","decoded","lenght","tokens","entry","encoded","entry1","entry2","compareName","display","to","from","obj","expanded","expand","code"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error(\"Cannot find module '\"+o+\"'\")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","var hex = require('./hex');\nvar api = require('./api');\n\n// Menu component.\n\nrequire('./components/menu');\n\n// Login component.\n\nrequire('./components/login');\n\n// Posts list component.\n\nrequire('./components/posts');\n\n// Posts edit component.\n\nrequire('./components/post');\n\n// Users list component.\n\nrequire('./components/users');\n\n// User edit component.\n\nrequire('./components/user');\n\n// Comments list component.\n\nrequire('./components/comments');\n\n// Directory listing component.\n\nrequire('./components/directory');\n\n// File view component.\n\nrequire('./components/file');\n\n// Global to format dates.\n\nwindow.formatDate = function(ts) {\n\n    return new Date(1000 * ts).toISOString().substring(0, 10);\n};\n\n// Helper to trim whitespace from values.\n\nko.subscribable.fn.trimmed = function() {\n\n    return ko.computed({\n\n        read: function() {\n\n            return this().trim();\n        },\n\n        write: function(value) {\n\n            this(value.trim());\n            this.valueHasMutated();\n        },\n\n        owner: this\n    });\n};\n\n// The main model.\n\nvar model = {\n\n    component: ko.observable(),\n\n    // FIXME changing this before component\n    // might have side effects.\n\n    params: ko.observable({}),\n\n    menu: {\n\n        active: ko.observable()\n    }\n};\n\n// Shows given component with params.\n\nmodel.show = function(name, params, menu) {\n\n    model.menu.active(menu);\n    model.params(params);\n    model.component(name);\n};\n\nko.applyBindings(model);\n\nroute(/^entries\\/([^\\/]+)/, function(type) {\n\n    model.show('posts', { type: type }, type + 's');\n});\n\nroute(/^entry\\/([^\\/]+)\\/([^\\/]+)/, function(type, id) {\n\n    model.show('post', { id: id }, type + 's');\n});\n\nroute(/^new\\/([^\\/]+)/, function(type) {\n\n    model.show('post', { type: type }, type + 's');\n});\n\nroute(/^files/, function() {\n\n    route.go('directory/' + hex.hex('/'));\n});\n\nroute(/^directory\\/([^\\/]+)/, function(directory) {\n\n    model.show('directory', { directory: directory }, 'files');\n});\n\nroute(/^file\\/([^\\/]+)/, function(file) {\n\n    model.show('file', { file: file }, 'files');\n});\n\nroute(/^comments\\/([^\\/]+)\\/([^\\/]+)/, function(type, id) {\n\n    model.show('comments', { id: id }, type + 's');\n});\n\nroute(/^users/, function() {\n\n    model.show('users', {}, 'users');\n});\n\nroute(/^user\\/new/, function() {\n\n    model.show('user', {}, 'users');\n});\n\nroute(/^user\\/([^\\/]+)/, function(id) {\n\n    model.show('user', { id: id }, 'users');\n});\n\nroute(/^login/, function() {\n\n    model.show('login', {});\n});\n\nroute(/^logout/, function() {\n\n    sessionStorage.removeItem('api-key');\n\n    route.go('login');\n});\n\nroute(/.*/, function() {\n\n    // FIXME go to first entries.\n\n    route.go(api.hasKey() ? 'entries/post' : 'login');\n});\n","exports.hex = function(string) {\n\n    var hex = '';\n\n    for(var i = 0; i < string.length; i++) {\n\n        hex += string.charCodeAt(i).toString(16);\n    }\n\n    return hex;\n};\n\n// FIXME this is broken encoding.\n\nexports.string = function(hex) {\n\n    if (typeof hex !== 'string') {\n\n        hex = hex.toString();\n    }\n\n    var string = '';\n\n    for (var i = 0; i < hex.length; i += 2) {\n\n        string += String.fromCharCode(parseInt(hex.substr(i, 2), 16));\n    }\n\n    return string;\n};\n","var xhr = require('./xhr');\n\n// FIXME make all API calls use it.\n\nfunction jsendAuth(options) {\n\n    options.headers = options.headers || {};\n\n    options.headers['X-Key'] = apiKey();\n\n    return jsend(options);\n}\n\nfunction jsend(options) {\n\n    return xhr(options).then(function(response) {\n\n        var json = JSON.parse(response);\n\n        if (json.status === 'success') {\n\n            return json.data;\n\n        } else {\n\n            throw new Error(json.message);\n        }\n    });\n}\n\nexports.login = function(username, password) {\n\n    var options = {\n\n        method: 'POST',\n\n        url: '/api/auth',\n\n        data: JSON.stringify({\n\n            username: username,\n            password: password\n        }),\n\n        headers: {\n\n            'Content-Type': 'application/json'\n        }\n    };\n\n    return xhr(options).then(function(response) {\n\n        return JSON.parse(response);\n    });\n};\n\nexports.posts = function(type) {\n\n    var options = {\n\n        url: '/api/entries/' + type,\n\n        headers: {\n\n            'X-Key': apiKey()\n        }\n    };\n\n    return xhr(options).then(function(response) {\n\n        return JSON.parse(response).data;\n    });\n};\n\nexports.post = function(id) {\n\n    var options = {\n\n        url: '/api/entry/' + encodeURIComponent(id),\n\n        headers: { 'X-Key': apiKey() }\n    };\n\n    return xhr(options).then(function(response) {\n\n        return JSON.parse(response).data;\n    });\n};\n\nexports.entryInfo = function(id) {\n\n    var options = {\n\n        url: '/api/entry/' + encodeURIComponent(id) + '/info',\n\n        headers: { 'X-Key': apiKey() }\n    };\n\n    return xhr(options).then(function(response) {\n\n        return JSON.parse(response).data;\n    });\n};\n\n// Retrieves the given post comments.\n\nexports.comments = function(id) {\n\n    var options = {\n\n        url: '/api/post/' + encodeURIComponent(id) + '/comments',\n\n        headers: { 'X-Key': apiKey() }\n    };\n\n    return xhr(options).then(function(response) {\n\n        return JSON.parse(response).data;\n    });\n};\n\n// Removes the given comment.\n\nexports.removeComment = function(id) {\n\n    return jsendAuth({\n\n        method: 'DELETE',\n\n        url: '/api/comment/' + encodeURIComponent(id)\n    });\n};\n\nexports.updatePost = function(id, data) {\n\n    var options = {\n\n        method: 'PUT',\n\n        url: '/api/entry/' + id,\n\n        data: JSON.stringify(data),\n\n        headers: { 'X-Key': apiKey(), 'Content-Type': 'application/json' }\n    };\n\n    return xhr(options).then(function(response) {\n\n        return JSON.parse(response);\n    });\n};\n\nexports.savePost = function(data) {\n\n    var options = {\n\n        method: 'POST',\n\n        url: '/api/entry',\n\n        data: JSON.stringify(data),\n\n        headers: { 'X-Key': apiKey(), 'Content-Type': 'application/json' }\n    };\n\n    return xhr(options).then(function(response) {\n\n        return JSON.parse(response);\n    });\n};\n\n// Removes the given post.\n\nexports.removePost = function(id) {\n\n    var options = {\n\n        method: 'DELETE',\n\n        url: '/api/entry/' + encodeURIComponent(id),\n\n        headers: { 'X-Key': apiKey() }\n    };\n\n    return xhr(options).then(function(response) {\n\n        return JSON.parse(response);\n    });\n};\n\nexports.directory = function(directory) {\n\n    var options = {\n\n        url: '/api/directory/' + encodeURIComponent(directory),\n\n        headers: { 'X-Key': apiKey() }\n    };\n\n    return xhr(options).then(function(response) {\n\n        return JSON.parse(response).data;\n    });\n};\n\n// Creates the subdirectory.\n// Assumes that directory is hex-encoded\n// and subdirectory is not.\n\nexports.createDirectory = function(directory, subdirectory) {\n\n    return jsendAuth({\n\n        method: 'POST',\n\n        url: '/api/directory/' + encodeURIComponent(directory) + '/' +\n            encodeURIComponent(subdirectory)\n    });\n};\n\n// Removes the directory.\n// Assumes that file path is hex-encoded.\n\nexports.removeDirectory = function(directory) {\n\n    return jsendAuth({\n\n        method: 'DELETE',\n\n        url: '/api/directory/' + encodeURIComponent(directory)\n    });\n};\n\n// Retrieves file metainfo.\n// Assumes that file path is hex-encoded.\n\nexports.file = function(file) {\n\n    return jsendAuth({\n\n        url: '/api/file/' + encodeURIComponent(file)\n    });\n};\n\n// Removes the given file.\n// Assumes that file path is hex-encoded.\n\nexports.removeFile = function(file) {\n\n    return jsendAuth({\n\n        method: 'DELETE',\n\n        url: '/api/file/' + encodeURIComponent(file)\n    });\n};\n\n// Retrieves all users.\n\nexports.users = function() {\n\n    var options = {\n\n        url: '/api/users',\n\n        headers: { 'X-Key': apiKey() }\n    };\n\n    return xhr(options).then(function(response) {\n\n        return JSON.parse(response).data;\n    });\n};\n\n// Retrieves the given user.\n\nexports.user = function(id) {\n\n    var options = {\n\n        url: '/api/user/' + encodeURIComponent(id),\n\n        headers: { 'X-Key': apiKey() }\n    };\n\n    return xhr(options).then(function(response) {\n\n        return JSON.parse(response).data;\n    });\n};\n\n// Retrieves the current user info.\n\nexports.userInfo = function() {\n\n    return jsendAuth({\n\n        url: '/api/user/info'\n    });\n};\n\n// Updates the given user.\n\nexports.updateUser = function(id, data) {\n\n    var options = {\n\n        method: 'PUT',\n\n        data: JSON.stringify(data),\n\n        url: '/api/user/' + encodeURIComponent(id),\n\n        headers: { 'X-Key': apiKey(), 'Content-Type': 'application/json' }\n    };\n\n    return xhr(options).then(function(response) {\n\n        return JSON.parse(response);\n    });\n};\n\n// Saves the new user.\n\nexports.saveUser = function(data) {\n\n    var options = {\n\n        method: 'POST',\n\n        data: JSON.stringify(data),\n\n        url: '/api/user',\n\n        headers: { 'X-Key': apiKey(), 'Content-Type': 'application/json' }\n    };\n\n    return xhr(options).then(function(response) {\n\n        return JSON.parse(response);\n    });\n};\n\n// Removes the given user.\n\nexports.removeUser = function(id) {\n\n    var options = {\n\n        method: 'DELETE',\n\n        url: '/api/user/' + encodeURIComponent(id),\n\n        headers: { 'X-Key': apiKey() }\n    };\n\n    return xhr(options).then(function(response) {\n\n        return JSON.parse(response);\n    });\n};\n\n// Checks whether the API key has been set.\n\nexports.hasKey = function() {\n\n    return !!sessionStorage.getItem('api-key');\n};\n\nvar apiKey = exports.apiKey = function() {\n\n    var key = sessionStorage.getItem('api-key');\n\n    if (!key) {\n\n        throw new Error('API key is not set');\n    }\n\n    return key;\n};\n","\n\n// Creates view model for the main menu.\n\nfunction menu(params) {\n\n    var model = {\n\n        active: params.active\n    };\n\n    return model;\n}\n\nko.components.register('bc-menu', {\n\n    viewModel: { createViewModel: menu },\n\n    template: \"<!-- ko if: active() -->\\n    <div class=\\\"btn-group\\\" id=\\\"menu\\\">\\n        <a data-bind=\\\"css: { active: active() === 'posts' }\\\" class=\\\"btn btn-default\\\" href=\\\"#entries/post\\\">Posts</a>\\n        <a data-bind=\\\"css: { active: active() === 'pages' }\\\" class=\\\"btn btn-default\\\" href=\\\"#entries/page\\\">Pages</a>\\n        <a data-bind=\\\"css: { active: active() === 'blocks' }\\\" class=\\\"btn btn-default\\\" href=\\\"#entries/block\\\">Blocks</a>\\n        <a data-bind=\\\"css: { active: active() === 'users' }\\\" class=\\\"btn btn-default\\\" href=\\\"#users\\\">Users</a>\\n        <a data-bind=\\\"css: { active: active() === 'files' }\\\" class=\\\"btn btn-default\\\" href=\\\"#files\\\">Files</a>\\n        <a class=\\\"btn btn-default\\\" href=\\\"#logout\\\">Logout</a>\\n    </div>\\n<!-- /ko -->\\n\"\n});\n","\nvar api = require('../api');\nvar message = require('../message');\nvar validate = require('../validate');\n\n// Creates view model for the login page.\n\nfunction page() {\n\n    var model = {\n\n        username: ko.observable('').trimmed(),\n\n        password: ko.observable('').trimmed()\n    };\n\n    model.login = function(form) {\n\n        validate.clear(form);\n\n        var username = model.username();\n\n        var password = model.password();\n\n        if (username === '') {\n\n            validate.error('username', 'Username is not entered.');\n\n        } else if (!username.match(/^[^@]+@[^@]+$/)) {\n\n            validate.error('username', 'Username must be an email.');\n        }\n\n        if (password === '') {\n\n            validate.error('password', 'Password is not entered.');\n        }\n\n        if (validate.hasError(form)) {\n\n            return false;\n        }\n\n        api.login(username, password).then(function(res) {\n\n            if (res.status === 'success') {\n\n                sessionStorage.setItem('api-key', res.data.key);\n\n                route.go('posts');\n\n            } else {\n\n                validate.formError(form, res.message);\n            }\n\n        }).catch(message.error);\n    };\n\n    return model;\n}\n\nko.components.register('login', {\n\n    viewModel: { createViewModel: page },\n\n    template: \"<h2>Login</h2>\\n\\n<form data-bind=\\\"submit: login\\\">\\n    <div class=\\\"form-group\\\">\\n        <label class=\\\"control-label\\\" for=\\\"username\\\">Username</label>\\n        <input data-bind=\\\"textInput: username\\\"\\n            type=\\\"text\\\" name=\\\"username\\\" title=\\\"Username\\\"\\n            placeholder=\\\"Username\\\" class=\\\"form-control\\\" id=\\\"username\\\">\\n    </div>\\n    <div class=\\\"form-group\\\">\\n        <label class=\\\"control-label\\\" for=\\\"password\\\">Password</label>\\n        <input data-bind=\\\"textInput: password\\\"\\n            type=\\\"password\\\" name=\\\"password\\\" title=\\\"Password\\\"\\n            placeholder=\\\"Password\\\" class=\\\"form-control\\\" id=\\\"password\\\">\\n    </div>\\n    <button type=\\\"submit\\\" class=\\\"btn btn-default\\\">Login</button>\\n</form>\\n\"\n});\n","\nvar api = require('../api');\nvar message = require('../message');\nvar posts_item = require('../vm/posts_item');\n\n// Component for displaying a post list.\n\nfunction page(params) {\n\n    var type = params.type;\n\n    var model = {\n\n        type: type,\n\n        all: ko.observable([]),\n\n        count: ko.observable(5),\n\n        step: ko.observable(5)\n    };\n\n    // Shows whether there are more\n    // pager pages.\n\n    model.hasMore = ko.pureComputed(function() {\n\n        return model.count() < model.all().length;\n    });\n\n    // Shows new pager page with posts.\n\n    model.showMore = function() {\n\n        model.count(model.count() + model.step());\n\n        setTimeout(function() {\n\n            // Scrolls to the bottom.\n\n            window.scrollTo(0, document.body.scrollHeight);\n\n        }, 50);\n    };\n\n    // Shows all posts.\n\n    model.showAll = function() {\n\n        model.count(model.all().length);\n    };\n\n    // Posts array considering the current\n    // pager state.\n\n    model.posts = ko.pureComputed(function() {\n\n        var all = model.all();\n\n        return all.slice(0, model.count());\n    });\n\n    var tasks = [ api.userInfo(), api.posts(type) ];\n\n    Promise.all(tasks).then(function(data) {\n\n        var info = data[0], posts = data[1];\n\n        posts.sort(function(post1, post2) {\n\n            return post2.date_updated - post1.date_updated;\n        });\n\n        model.all(posts.map(function(data) {\n\n            var post = posts_item.create(data);\n\n            post.editable = info.type === 'admin' || info.$id === post.author;\n\n            return post;\n\n        }));\n\n    }).catch(message.error);\n\n    return model;\n}\n\nko.components.register('posts', {\n\n    viewModel: { createViewModel: page },\n\n    template: \"<h2>Posts</h2>\\n\\n<ul data-bind=\\\"foreach: posts\\\" class=\\\"list-group\\\">\\n    <li class=\\\"list-group-item post-item\\\">\\n        <h4 data-bind=\\\"click: expand, text: title\\\" class=\\\"list-group-item-heading\\\"></h4>\\n        <div class=\\\"list-group-item-text\\\">\\n            Update date: <span data-bind=\\\"text: formatDate(date_updated)\\\"></span>,\\n            comments: <span data-bind=\\\"text: comments\\\"></span>\\n            <div data-bind=\\\"visible: expanded\\\" class=\\\"post-controls\\\">\\n                <a data-bind=\\\"attr: { href: '#entry/' + type + '/' + $id }, css: { disabled: !editable }\\\"\\n                    class=\\\"btn btn-default btn-sm\\\" href=\\\"#\\\">\\n                    <span class=\\\"glyphicon glyphicon-edit\\\"></span> Edit\\n                </a>\\n                <a data-bind=\\\"attr: { href: '#comments/' + type + '/' + $id }, visible: type === 'post', css: { disabled: comments === 0 || !editable }\\\"\\n                    class=\\\"btn btn-default btn-sm\\\" href=\\\"#\\\">\\n                    <span class=\\\"glyphicon glyphicon-comment\\\"></span> Comments\\n                </a>\\n                <a data-bind=\\\"click: remove, css: { disabled: !editable }\\\"\\n                    class=\\\"btn btn-default btn-sm\\\" href=\\\"#\\\">\\n                    <span class=\\\"glyphicon glyphicon-edit\\\"></span> Remove\\n                </a>\\n            </div>\\n        </div>\\n    </li>\\n</ul>\\n\\n<a data-bind=\\\"click: showMore, css: { disabled: !hasMore() }\\\" class=\\\"btn btn-default\\\" href=\\\"#\\\">\\n    <span class=\\\"glyphicon glyphicon-list-alt\\\"></span> Show more\\n</a>\\n<a data-bind=\\\"click: showAll, css: { disabled: !hasMore() }\\\" class=\\\"btn btn-default\\\" href=\\\"#\\\">\\n    <span class=\\\"glyphicon glyphicon-list-alt\\\"></span> Show all\\n</a>\\n<a data-bind=\\\"attr: { href: '#new/' + type }\\\" class=\\\"btn btn-default\\\" href=\\\"#\\\">\\n    <span class=\\\"glyphicon glyphicon-plus\\\"></span> Add\\n</a>\\n\"\n});\n","\nvar api = require('../api');\nvar post = require('../vm/post');\nvar message = require('../message');\n\n// Component for the post edit page.\n\nfunction page(params) {\n\n    var model = {\n\n        post: ko.observable()\n    };\n\n    var tasks;\n\n    if (params.id) {\n\n        // Edit existing post.\n\n        // FIXME only admin can call users?\n\n        tasks = [ api.userInfo(), api.users(), api.post(params.id) ];\n\n        Promise.all(tasks).then(function(data) {\n\n            var info = data[0], users = data[1], postData = data[2];\n\n            model.post(post.create(info, users, postData));\n\n            // Autoset initial textarea height.\n\n            var editor = document.getElementById('post-content');\n\n            editor.style.height = (editor.scrollHeight + 10) + 'px';\n\n        }).catch(message.error);\n\n    } else {\n\n        // Create a new post.\n\n        tasks = [ api.userInfo(), api.users() ];\n\n        Promise.all(tasks).then(function(data) {\n\n            var info = data[0], users = data[1];\n\n            model.post(post.create(info, users));\n\n            model.post().type(params.type);\n\n            var title = document.querySelector('#post-title');\n\n            title.focus();\n\n            if (typeof title.setSelectionRange === 'function') {\n\n                title.setSelectionRange(0, title.value.length);\n            }\n\n        }).catch(message.error);\n    }\n\n    return model;\n}\n\nko.components.register('post', {\n\n    viewModel: { createViewModel: page },\n\n    template: \"<!-- ko with: post -->\\n    <h2 data-bind=\\\"text: title\\\"></h2>\\n    <form data-bind=\\\"submit: submit\\\" autocomplete=\\\"off\\\" id=\\\"post\\\">\\n        <div class=\\\"form-group\\\">\\n            <label for=\\\"post-title\\\">Title</label>\\n            <input data-bind=\\\"value: title\\\"\\n                type=\\\"text\\\" class=\\\"form-control\\\" id=\\\"post-title\\\"\\n                placeholder=\\\"Title\\\">\\n        </div>\\n        <div class=\\\"form-group\\\">\\n            <label for=\\\"post-slug\\\">Slug</label>\\n            <input data-bind=\\\"value: slug\\\"\\n                type=\\\"text\\\" class=\\\"form-control\\\" id=\\\"post-slug\\\"\\n                placeholder=\\\"Slug\\\">\\n            <p class=\\\"help-block\\\">Slug should not be modified after publishing as it will break links.</p>\\n        </div>\\n        <div class=\\\"form-group\\\">\\n            <label for=\\\"post-description\\\">Description</label>\\n            <textarea\\n                data-bind=\\\"value: description\\\"\\n                class=\\\"form-control\\\" rows=\\\"3\\\" id=\\\"post-description\\\" placeholder=\\\"Description\\\"></textarea>\\n            <p class=\\\"help-block\\\">Description is used by search engines to show the page snippet.</p>\\n        </div>\\n        <div class=\\\"form-group\\\">\\n            <label for=\\\"post-content\\\">Content</label>\\n            <textarea\\n                data-bind=\\\"value: content\\\"\\n                class=\\\"form-control content\\\" rows=\\\"20\\\" id=\\\"post-content\\\"\\n                placeholder=\\\"Content\\\"></textarea>\\n        </div>\\n        <div class=\\\"form-group\\\">\\n            <label for=\\\"post-type\\\">Type</label>\\n            <select data-bind=\\\"value: type\\\" class=\\\"form-control\\\" id=\\\"post-type\\\">\\n                <option value=\\\"post\\\">Post</option>\\n                <option value=\\\"page\\\">Page</option>\\n                <option value=\\\"block\\\">Block</option>\\n            </select>\\n        </div>\\n        <div class=\\\"form-group\\\">\\n            <label for=\\\"post-content-type\\\">Content type</label>\\n            <select data-bind=\\\"value: content_type\\\" class=\\\"form-control\\\" id=\\\"post-content-type\\\">\\n                <option value=\\\"markdown\\\">Markdown</option>\\n                <option value=\\\"raw\\\">Raw</option>\\n            </select>\\n        </div>\\n        <div class=\\\"form-group\\\">\\n            <label for=\\\"post-author\\\">Author</label>\\n            <select data-bind=\\\"value: author, options: authors,\\n                optionsText: 'fullname', attr: { disabled: !author_selectable }\\\"\\n                class=\\\"form-control\\\" id=\\\"post-author\\\"></select>\\n        </div>\\n        <div class=\\\"form-group\\\">\\n            <label for=\\\"post-tags\\\">Tags</label>\\n            <input data-bind=\\\"value: tags\\\"\\n                type=\\\"text\\\" class=\\\"form-control\\\" id=\\\"post-tags\\\"\\n                placeholder=\\\"Tags\\\">\\n        </div>\\n        <div class=\\\"checkbox\\\">\\n            <label><input data-bind=\\\"checked: published\\\"\\n                type=\\\"checkbox\\\" id=\\\"post-published\\\"> Published</label>\\n        </div>\\n        <div class=\\\"form-group\\\">\\n            <label for=\\\"post-date\\\">Publish date</label>\\n            <input data-bind=\\\"value: date\\\"\\n                type=\\\"text\\\" class=\\\"form-control\\\" id=\\\"post-date\\\"\\n                placeholder=\\\"YYYY-MM-DD\\\">\\n        </div>\\n        <div class=\\\"form-group\\\">\\n            <label for=\\\"post-update\\\">Update date</label>\\n            <input data-bind=\\\"value: update\\\"\\n                type=\\\"text\\\" class=\\\"form-control\\\" id=\\\"post-update\\\"\\n                placeholder=\\\"YYYY-MM-DD\\\">\\n        </div>\\n        <div class=\\\"checkbox\\\">\\n            <label><input data-bind=\\\"checked: commenting\\\" type=\\\"checkbox\\\"> Commenting</label>\\n        </div>\\n        <div class=\\\"form-group\\\">\\n            <label for=\\\"post-language\\\">Language</label>\\n            <select data-bind=\\\"value: language, options: languages,\\n                optionsText: 'name', optionsValue: 'code'\\\"\\n                class=\\\"form-control\\\" id=\\\"post-language\\\"></select>\\n        </div>\\n        <button data-bind=\\\"click: save\\\" class=\\\"btn btn-default\\\">\\n            <span class=\\\"glyphicon glyphicon-ok\\\"></span> Save/leave\\n        </button>\\n        <button type=\\\"submit\\\" class=\\\"btn btn-default\\\">\\n            <span class=\\\"glyphicon glyphicon-ok\\\"></span> Save/continue\\n        </button>\\n        <a data-bind=\\\"attr: { href: '#' + type() + 's' }\\\" class=\\\"btn btn-default\\\" href=\\\"#\\\">\\n            <span class=\\\"glyphicon glyphicon-arrow-left\\\"></span> Posts\\n        </a>\\n    </form>\\n<!-- /ko -->\\n\"\n});\n","\nvar api = require('../api');\nvar message = require('../message');\nvar users_item = require('../vm/users_item');\n\n// Component for displaying the users list.\n\nfunction page() {\n\n    var model = {\n\n        users: ko.observableArray([]),\n\n        type: ko.observable()\n    };\n\n    // Loads users and current user info.\n\n    var tasks = [ api.userInfo(), api.users() ];\n\n    Promise.all(tasks).then(function(data) {\n\n        var info = data[0], users = data[1];\n\n        model.type(info.type);\n\n        model.users(users.map(function(data) {\n\n            var user = users_item.create(data);\n\n            user.editable = info.type === 'admin' || user.$id === info.$id;\n\n            return user;\n\n        }));\n\n    }).catch(message.error);\n\n    return model;\n}\n\nko.components.register('users', {\n\n    viewModel: { createViewModel: page },\n\n    template: \"<h2>Users</h2>\\n\\n<ul data-bind=\\\"foreach: users\\\" class=\\\"list-group\\\">\\n    <li class=\\\"list-group-item post-item\\\">\\n        <h4 data-bind=\\\"click: expand, text: fullname\\\" class=\\\"list-group-item-heading\\\"></h4>\\n        <div class=\\\"list-group-item-text\\\">\\n            Type: <span data-bind=\\\"text: type\\\"></span>,\\n            username: <span data-bind=\\\"text: username\\\"></span>\\n            <div data-bind=\\\"visible: expanded\\\" class=\\\"post-controls\\\">\\n                <a data-bind=\\\"attr: { href: '#user/' + $id }, css: { disabled: !editable }\\\"\\n                    class=\\\"btn btn-default btn-sm\\\" href=\\\"#\\\">\\n                    <span class=\\\"glyphicon glyphicon-edit\\\"></span> Edit\\n                </a>\\n                <a data-bind=\\\"click: remove, css: { disabled: !editable }\\\"\\n                    class=\\\"btn btn-default btn-sm\\\" href=\\\"#\\\">\\n                    <span class=\\\"glyphicon glyphicon-remove\\\"></span> Remove\\n                </a>\\n            </div>\\n        </div>\\n    </li>\\n</ul>\\n\\n<a data-bind=\\\"css: { disabled: type() !== 'admin' }\\\"\\n    class=\\\"btn btn-default\\\" href=\\\"#user/new\\\">\\n    <span class=\\\"glyphicon glyphicon-plus\\\"></span> Add\\n</a>\\n\"\n});\n","\nvar api = require('../api');\nvar focus = require('../focus');\nvar user = require('../vm/user');\nvar message = require('../message');\n\n// Component for user edit page.\n\nfunction page(params) {\n\n    var model = {\n\n        user: ko.observable()\n    };\n\n    if (params.id) {\n\n        // Edit existing user.\n\n        var tasks = [ api.userInfo(), api.user(params.id) ];\n\n        Promise.all(tasks).then(function(data) {\n\n            var info = data[0], userData = data[1];\n\n            model.user(user.create(info, userData));\n\n            focus('#user-fullname');\n\n        }).catch(message.error);\n\n    } else {\n\n        // Create a new user.\n\n        api.userInfo().then(function(info) {\n\n            model.user(user.create(info));\n\n            focus('#user-fullname');\n\n        }).catch(message.error);\n    }\n\n    return model;\n}\n\nko.components.register('user', {\n\n    viewModel: { createViewModel: page },\n\n    template: \"<!-- ko with: user -->\\n    <h2 data-bind=\\\"text: fullname\\\"></h2>\\n\\n    <form data-bind=\\\"submit: save\\\">\\n        <div class=\\\"form-group\\\">\\n            <label for=\\\"user-fullname\\\">Full name</label>\\n            <input data-bind=\\\"value: fullname\\\"\\n                type=\\\"text\\\" class=\\\"form-control\\\" id=\\\"user-fullname\\\"\\n                placeholder=\\\"Full name\\\">\\n        </div>\\n        <div class=\\\"form-group\\\">\\n            <label for=\\\"user-username\\\">Username</label>\\n            <input data-bind=\\\"value: username\\\"\\n                type=\\\"text\\\" class=\\\"form-control\\\" id=\\\"user-username\\\"\\n                placeholder=\\\"Username\\\">\\n        </div>\\n        <div class=\\\"form-group\\\">\\n            <label for=\\\"user-type\\\">Type</label>\\n            <select data-bind=\\\"value: type\\\" class=\\\"form-control\\\">\\n                <option value=\\\"author\\\">Author</option>\\n                <option value=\\\"admin\\\">Admin</option>\\n            </select>\\n        </div>\\n        <div class=\\\"form-group\\\">\\n            <label for=\\\"user-link\\\">Link</label>\\n            <input data-bind=\\\"value: link\\\"\\n                type=\\\"text\\\" class=\\\"form-control\\\" id=\\\"user-link\\\"\\n                placeholder=\\\"Link\\\">\\n        </div>\\n        <div class=\\\"checkbox\\\">\\n            <label><input data-bind=\\\"checked: files, disable: my_type !== 'admin'\\\" type=\\\"checkbox\\\">\\n                Allow file management</label>\\n        </div>\\n        <div class=\\\"checkbox\\\">\\n            <label><input data-bind=\\\"checked: password_edit, disable: creating\\\" type=\\\"checkbox\\\">\\n                Edit password</label>\\n        </div>\\n        <div data-bind=\\\"visible: password_edit\\\" class=\\\"form-group\\\">\\n            <label for=\\\"user-password\\\">New password</label>\\n            <input data-bind=\\\"value: password\\\"\\n                type=\\\"password\\\" class=\\\"form-control\\\" id=\\\"user-password\\\"\\n                placeholder=\\\"Password\\\">\\n            <div class=\\\"checkbox\\\">\\n                <label><input data-bind=\\\"checked: password_text\\\" type=\\\"checkbox\\\">\\n                    Show text</label>\\n            </div>\\n        </div>\\n        <button type=\\\"submit\\\" class=\\\"btn btn-default\\\">\\n            <span class=\\\"glyphicon glyphicon-ok\\\"></span> Save\\n        </button>\\n        <a class=\\\"btn btn-default\\\" href=\\\"#users\\\">\\n            <span class=\\\"glyphicon glyphicon-arrow-left\\\"></span> Cancel\\n        </a>\\n    </form>\\n<!-- /ko -->\\n\"\n});\n","\nvar api = require('../api');\nvar message = require('../message');\nvar comments_item = require('../vm/comments_item');\n\n// Creates view model for the comments list.\n\nfunction page(params) {\n\n    var model = {\n\n        title: ko.observable(),\n\n        comments: ko.observable([])\n    };\n\n    var tasks = [ api.entryInfo(params.id), api.comments(params.id) ];\n\n    Promise.all(tasks).then(function(data) {\n\n        var info = data[0], comments = data[1];\n\n        model.title(info.title);\n\n        model.comments(comments.map(function(data) {\n\n            return comments_item.create(data);\n\n        }));\n\n    }).catch(message.error);\n\n    return model;\n}\n\nko.components.register('comments', {\n\n    viewModel: { createViewModel: page },\n\n    template: \"<h2 data-bind=\\\"text: title\\\"></h2>\\n<h3>Comments</h3>\\n<ul data-bind=\\\"foreach: comments\\\" class=\\\"list-group\\\">\\n    <li class=\\\"list-group-item post-item\\\">\\n        <h4 data-bind=\\\"text: author, click: expand\\\" class=\\\"list-group-item-heading\\\"></h4>\\n        <div class=\\\"list-group-item-text\\\">\\n            Date: <span data-bind=\\\"text: formatDate(date)\\\"></span>\\n            <div data-bind=\\\"visible: expanded\\\" class=\\\"post-controls\\\">\\n                <div class=\\\"panel panel-default\\\">\\n                    <div data-bind=\\\"text: message\\\" class=\\\"panel-body\\\"></div>\\n                </div>\\n                <a data-bind=\\\"click: remove\\\" class=\\\"btn btn-default btn-sm\\\" href=\\\"#\\\">\\n                    <span class=\\\"glyphicon glyphicon-remove\\\"></span> Remove\\n                </a>\\n            </div>\\n        </div>\\n    </li>\\n</ul>\\n\"\n});\n","\nvar api = require('../api');\nvar path = require('../path');\nvar message = require('../message');\nvar directory_item = require('../vm/directory_item');\n\n// Component for displaying a directory.\n\nfunction page(params) {\n\n    var directory = params.directory;\n\n    var model = {\n\n        directory: path.decode(directory),\n\n        entries: ko.observable([]),\n\n        parent: path.parent(directory),\n\n        subdirectory: {\n\n            form: ko.observable(false),\n\n            directory: ko.observable('').trimmed()\n        },\n\n        upload: {\n\n            form: ko.observable(false),\n\n            progress: ko.observable(0)\n        }\n    };\n\n    // Opens subdirectory form.\n\n    model.subdirectory.show = function() {\n\n        model.subdirectory.form(true);\n    };\n\n    // Creates the subdirectory.\n\n    model.subdirectory.submit = function() {\n\n        var sub = model.subdirectory.directory();\n\n        api.createDirectory(directory, sub).then(function() {\n\n            message.info('Directory \"' + path.decode(path.join(directory, sub)) +\n                '\" has been created.');\n\n            model.subdirectory.form(false);\n\n            route.go('directory/' + path.join(directory, sub));\n\n        }).catch(message.error);\n    };\n\n    // Cancels and hides the subdirectory form.\n    // Resets the form.\n\n    model.subdirectory.cancel = function() {\n\n        model.subdirectory.form(false);\n        model.subdirectory.directory('');\n    };\n\n    // Shows file upload form.\n\n    model.upload.show = function() {\n\n        model.upload.form(true);\n    };\n\n    // Submits the upload form and\n    // performs the file upload process.\n\n    model.upload.submit = function() {\n\n        var file = document.getElementById('directory-file').files[0];\n\n        if (!file) {\n\n            return;\n        }\n\n        model.upload.file = file;\n\n        var reader = new FileReader();\n\n        reader.onload = function() {\n\n            var xhr = new XMLHttpRequest();\n\n            xhr.upload.addEventListener('progress', model.upload.progress, false);\n\n            xhr.addEventListener('load', model.upload.complete, false);\n            xhr.addEventListener('error', model.upload.failed, false);\n            xhr.addEventListener('abort', model.upload.aborted, false);\n\n            xhr.open('POST', '/api/upload/' + encodeURIComponent(directory));\n\n            xhr.setRequestHeader('X-Key', api.apiKey());\n            xhr.setRequestHeader('X-File-Name', file.name);\n            xhr.setRequestHeader('Content-Type', 'application/octet-stream');\n\n            xhr.send(new Uint8Array(reader.result));\n        };\n\n        reader.readAsArrayBuffer(file);\n    };\n\n    // Cancels and hides the upload form.\n\n    model.upload.cancel = function() {\n\n        model.upload.form(false);\n    };\n\n    // Reports the upload progress.\n    // FIXME only works on Firefox?\n\n    model.upload.progress = function(e) {\n\n        if (e.lengthComputable) {\n\n            model.upload.progress(Math.round(e.loaded * 100 / e.total));\n        }\n    };\n\n    // Executed then the upload process\n    // is complete.\n\n    model.upload.complete = function() {\n\n        route.refresh();\n\n        message.info('File \"' + path.decode(path.join(directory, model.upload.file.name)) +\n            '\" has been uploaded.');\n    };\n\n    model.upload.failed = function() {\n\n        // FIXME needs error checking.\n    };\n\n    // Executed when the upload process\n    // was aborted.\n\n    model.upload.aborted = function() {\n\n        model.upload.form(false);\n    };\n\n    model.remove = function() {\n\n        if (confirm('Remove directory \"' + path.decode(directory) + '\"?')) {\n\n            api.removeDirectory(directory).then(function() {\n\n                message.info('Directory \"' + path.decode(directory) +\n                    '\" has been successfully removed.');\n\n                route.go('directory/' + model.parent);\n\n            }).catch(message.error);\n        }\n    };\n\n    api.directory(directory).then(function(list) {\n\n        var entries = list.map(function(data) {\n\n            return directory_item.create(directory, data);\n\n        });\n\n        entries.sort(directory_item.compare);\n\n        model.entries(entries);\n\n    }).catch(message.error);\n\n    return model;\n}\n\nko.components.register('directory', {\n\n    viewModel: { createViewModel: page },\n\n    template: \"<h2 data-bind=\\\"text: 'Directory ' + directory\\\"></h2>\\n\\n<p>\\n    <!-- ko if: directory !== '/' -->\\n        <a data-bind=\\\"attr: { href: '#directory/' + parent }\\\"\\n            class=\\\"btn btn-default\\\" href=\\\"#\\\">\\n            <span class=\\\"glyphicon glyphicon-arrow-up\\\"></span> Up\\n        </a>\\n    <!-- /ko -->\\n    <a data-bind=\\\"click: subdirectory.show\\\" class=\\\"btn btn-default\\\" href=\\\"#\\\">\\n        <span class=\\\"glyphicon glyphicon-folder-close\\\"></span> Add\\n    </a>\\n    <a data-bind=\\\"click: upload.show\\\" class=\\\"btn btn-default\\\" href=\\\"#\\\">\\n        <span class=\\\"glyphicon glyphicon-upload\\\"></span> Upload\\n    </a>\\n    <!-- ko if: directory !== '/' -->\\n        <a data-bind=\\\"click: remove\\\"\\n            class=\\\"btn btn-default\\\" href=\\\"#\\\">\\n            <span class=\\\"glyphicon glyphicon-remove-circle\\\"></span> Remove\\n        </a>\\n    <!-- /ko -->\\n</p>\\n\\n<!-- ko if: subdirectory.form() -->\\n    <div class=\\\"panel panel-default\\\">\\n        <div class=\\\"panel-heading\\\">New directory</div>\\n        <div class=\\\"panel-body\\\">\\n            <form data-bind=\\\"submit: subdirectory.submit\\\">\\n                <div class=\\\"form-group\\\">\\n                    <label for=\\\"directory-new\\\">Directory name</label>\\n                    <input data-bind=\\\"value: subdirectory.directory\\\"\\n                        type=\\\"text\\\" class=\\\"form-control\\\" id=\\\"directory-new\\\"\\n                        placeholder=\\\"Directory name\\\" required=\\\"true\\\">\\n                </div>\\n                <button type=\\\"submit\\\" class=\\\"btn btn-default\\\">\\n                    <span class=\\\"glyphicon glyphicon-folder-close\\\"></span> Add\\n                </button>\\n                <a data-bind=\\\"click: subdirectory.cancel\\\" class=\\\"btn btn-default\\\" href=\\\"#\\\">\\n                    <span class=\\\"glyphicon glyphicon-remove-circle\\\"></span> Cancel\\n                </a>\\n            </form>\\n        </div>\\n    </div>\\n<!-- /ko -->\\n\\n<!-- ko if: upload.form() -->\\n    <div class=\\\"panel panel-default\\\">\\n        <div class=\\\"panel-heading\\\">Upload file</div>\\n        <div class=\\\"panel-body\\\">\\n            <form data-bind=\\\"submit: upload.submit\\\">\\n                <div class=\\\"form-group\\\">\\n                    <label for=\\\"directory-file\\\">File</label>\\n                    <input type=\\\"file\\\" id=\\\"directory-file\\\"\\n                        placeholder=\\\"Your file\\\" required=\\\"true\\\">\\n                </div>\\n                <div class=\\\"form-group\\\">\\n                    <div class=\\\"progress\\\">\\n                        <div data-bind=\\\"attr: { 'aria-valuenow': upload.progress }, style: { width: upload.progress + '%' }\\\"\\n                            class=\\\"progress-bar\\\" role=\\\"progressbar\\\" aria-valuenow=\\\"0\\\"\\n                            aria-valuemin=\\\"0\\\" aria-valuemax=\\\"100\\\" style=\\\"width: 0%\\\">\\n                            <span data-bind=\\\"text: upload.progress + '% complete'\\\" class=\\\"sr-only\\\"></span>\\n                        </div>\\n                    </div>\\n                </div>\\n                <button type=\\\"submit\\\" class=\\\"btn btn-default\\\">\\n                    <span class=\\\"glyphicon glyphicon-upload\\\"></span> Upload\\n                </button>\\n                <a data-bind=\\\"click: upload.cancel\\\" class=\\\"btn btn-default\\\" href=\\\"#\\\">\\n                    <span class=\\\"glyphicon glyphicon-remove-circle\\\"></span> Cancel\\n                </a>\\n            </form>\\n        </div>\\n    </div>\\n<!-- /ko -->\\n\\n<div data-bind=\\\"foreach: entries\\\" class=\\\"list-group\\\">\\n    <a data-bind=\\\"attr: { href: (directory ? '#directory/' : '#file/') + encoded }\\\" href=\\\"#\\\" class=\\\"list-group-item\\\">\\n        <span data-bind=\\\"css: { 'glyphicon-folder-close': directory, 'glyphicon-file': !directory }\\\" class=\\\"glyphicon\\\"></span>\\n        <span data-bind=\\\"text: name\\\"></span>\\n    </a>\\n</div>\\n\"\n});\n","\nvar api = require('../api');\nvar path = require('../path');\nvar message = require('../message');\n\n// Component for displaying a directory.\n\nfunction page(params) {\n\n    var file = params.file;\n\n    var model = {\n\n        file: path.decode(file),\n\n        parent: path.parent(file),\n\n        size: ko.observable(),\n\n        date: ko.observable(0)\n    };\n\n    model.remove = function() {\n\n        if (confirm('Remove file ' + path.decode(file) + '?')) {\n\n            api.removeFile(file).then(function() {\n\n                message.info('File \"' + path.decode(file) + '\" removed.');\n\n                route.go('directory/' + model.parent);\n\n            }).catch(message.error);\n        }\n    };\n\n    api.file(file).then(function(data) {\n\n        model.size(data.size);\n\n        model.date(data.modified);\n\n    }).catch(message.error);\n\n    return model;\n}\n\nko.components.register('file', {\n\n    viewModel: { createViewModel: page },\n\n    template: \"<h2 data-bind=\\\"text: 'File ' + file\\\"></h2>\\n<p>\\n    File size: <span data-bind=\\\"text: size\\\"></span> bytes<br>\\n    Last uploaded: <span data-bind=\\\"text: formatDate(date())\\\"></span>\\n</p>\\n<p>\\n    <a data-bind=\\\"attr: { href: '#directory/' + parent }\\\" class=\\\"btn btn-default\\\" href=\\\"#\\\">\\n        <span class=\\\"glyphicon glyphicon-arrow-up\\\"></span> Up\\n    </a>\\n    <a data-bind=\\\"attr: { href: file }\\\" href=\\\"#\\\" target=\\\"_blank\\\" class=\\\"btn btn-default\\\">\\n        Direct link (opens in new tab)\\n    </a>\\n    <a data-bind=\\\"click: remove\\\" class=\\\"btn btn-default\\\" href=\\\"#\\\">\\n        <span class=\\\"glyphicon glyphicon-remove-circle\\\"></span> Remove\\n    </a>\\n</p>\\n\"\n});\n","var spin = require('./spin');\n\n// From https://gist.github.com/matthewp/3099268\n\nvar count = 0;\n\nmodule.exports = function(options) {\n\n    return new Promise(function(resolve, reject) {\n\n        var req = new XMLHttpRequest();\n\n        req.open(options.method || 'GET', options.url, true);\n\n        Object.keys(options.headers || {}).forEach(function (key) {\n\n            req.setRequestHeader(key, options.headers[key]);\n        });\n\n        req.onreadystatechange = function(e) {\n\n            if (req.readyState !== 4) {\n\n                return;\n            }\n\n            count -= 1;\n\n            if (count === 0) {\n\n                spin.hide();\n            }\n\n            if (req.status !== 200) {\n\n                reject(new Error('Server responded with a status of ' + req.status));\n\n            } else {\n\n                resolve(req.responseText);\n            }\n        };\n\n        if (count === 0) {\n\n            spin.show();\n        }\n\n        count += 1;\n\n        req.send(options.data);\n    });\n};\n","// Shows informational message.\n\nexports.info = function(text) {\n\n    var messages = document.getElementById('messages');\n    var message = document.createElement('div');\n\n    message.className = 'alert alert-success message';\n    message.innerHTML = text;\n\n    messages.appendChild(message);\n\n    setTimeout(function() {\n\n        messages.removeChild(message);\n\n    }, 2000);\n};\n\n// Shows error message.\n\nexports.error = function(err) {\n\n    var button = document.createElement('button');\n\n    button.className = 'close';\n    button.innerHTML = '&times;';\n\n    var text = document.createElement('span');\n    text.innerHTML = err.toString();\n\n    var messages = document.getElementById('messages');\n    var message = document.createElement('div');\n\n    message.className = 'alert alert-danger message';\n    message.appendChild(button);\n    message.appendChild(text);\n\n    button.addEventListener('click', function() {\n\n        messages.removeChild(message);\n\n    }, false);\n\n    messages.appendChild(message);\n\n    if (err instanceof Error) {\n\n        console.error(err.stack);\n    }\n};\n","// Cleans the form from error messages.\n\nexports.clear = function(form) {\n\n    var errors = form.querySelectorAll('.error-message');\n    var error, i;\n\n    for (i = 0; i < errors.length; i++) {\n\n        error = errors.item(i);\n\n        error.parentNode.classList.remove('has-error');\n        error.parentNode.removeChild(error);\n    }\n\n    errors = form.parentNode.querySelectorAll('.alert-danger');\n\n    for (i = 0; i < errors.length; i++) {\n\n        error = errors.item(i);\n        error.parentNode.removeChild(error);\n    }\n};\n\n// Checks whether the form\n// has a validation error.\n\nexports.hasError = function(form) {\n\n    return form.querySelectorAll('.error-message').length > 0;\n};\n\n// Adds error to the container of the\n// given input.\n\nexports.error = function(id, message) {\n\n    var elem = document.getElementById(id);\n\n    var error = document.createElement('div');\n\n    error.className = 'error-message';\n    error.innerHTML = message;\n\n    elem.parentNode.appendChild(error);\n    elem.parentNode.classList.add('has-error');\n};\n\n// Sets error to the whole form.\n\nexports.formError = function(form, message) {\n\n    var error = document.createElement('div');\n\n    error.className = 'alert alert-danger';\n    error.innerHTML = message;\n\n    form.parentNode.insertBefore(error, form);\n};\n","var api = require('../api');\nvar assign = require('../assign');\nvar message = require('../message');\nvar expandable = require('./expandable');\n\n// Creates posts view model for\n// the users list view.\n\nexports.create = function(data) {\n\n    var post = {\n\n        editable: false\n    };\n\n    // Make it expandable.\n\n    expandable.mixin(post);\n\n    // Copies data attributes.\n\n    assign(post, data);\n\n    // Removes the post.\n    // Asks confirmation.\n\n    post.remove = function() {\n\n        if (confirm('Remove the post?')) {\n\n            api.removePost(post.$id).then(function(response) {\n\n                if (response.status === 'success') {\n\n                    message.info('The post was removed.');\n\n                    route.refresh();\n\n                } else {\n\n                    message.error(response.message);\n                }\n\n            }).catch(message.error);\n        }\n    };\n\n    return post;\n};\n","var api = require('../api');\nvar message = require('../message');\nvar validate = require('../validate');\nvar languages = require('../languages');\n\n// Creates post view model for already\n// existing post or a new post. For new\n// post, data must be unset. The authors\n// argument must contain the list of all\n// users.\n\nexports.create = function(user, authors, data) {\n\n    // Sets author to the current user\n    // by default. Gets overriden by data.\n\n    var author = findAuthor(authors, user.$id);\n\n    var post = {\n\n        // List of authors. Used by the\n        // author list dropdown.\n\n        authors: authors,\n\n        // The post title. When this is\n        // the new post then initial slug\n        // is generated by it.\n\n        title: ko.observable('Untitled').trimmed(),\n\n        // The post slug. Can contain\n        // \"safe\" characters only.\n\n        slug: ko.observable('untitled').trimmed(),\n\n        // The post description. Can\n        // be left blank.\n\n        description: ko.observable('').trimmed(),\n\n        // The post content. Can be either\n        // Markdown or raw HTML.\n\n        content: ko.observable('').trimmed(),\n\n        // The post type. Currently\n        // available types are post,\n        // page and block.\n\n        type: ko.observable('post'),\n\n        // Type of the post content.\n        // Will be processed by the\n        // Markdown formatter when set\n        // to 'markdown''\n\n        content_type: ko.observable('markdown'),\n\n        // Flag to set whether the post\n        // is published or not.\n\n        published: ko.observable(false),\n\n        // Flag to set whether commenting\n        // is allowed or not.\n\n        commenting: ko.observable(true),\n\n        // List of tags. Tags are separated\n        // by commas.\n\n        tags: ko.observable('').trimmed(),\n\n        // The count of comments.\n        // Currently not used.\n\n        comments: ko.observable(0),\n\n\n        // Selected user. Only admins\n        // can select author other than\n        // themself.\n\n        author: ko.observable(author),\n\n        // Flag that indicates whether\n        // the current user can select\n        // the post author.\n\n        author_selectable: user.type === 'admin',\n\n        // Publish date as a string in\n        // the format YYYY-MM-DD. Might be\n        // unset when published flag is not set.\n\n        date: ko.observable('').trimmed(),\n\n        // Update date as a string in\n        // the format YYYY-MM-DD.\n\n        update: ko.observable('').trimmed(),\n\n        // Validates the post data.\n        // Saves or updates it using the API.\n\n        submit: function() {\n\n            submitPost(post, true);\n        },\n\n        // Similar to submit but leaves\n        // the form.\n\n        save: function() {\n\n            submitPost(post, false);\n        },\n\n        // The post language code. See\n        // languages.js for the list of codes.\n\n        language: ko.observable(bcLanguage),\n\n        // List of available languages.\n\n        languages: languages,\n\n        // Returns the plain data object\n        // to send to the backend.\n\n        toJS: function() {\n\n            var tags = post.tags().trim();\n\n            var date = post.date();\n\n            // date_published will be undefined when\n            // no date has been entered.\n\n            var date_published;\n\n            if (date !== '') {\n\n                date_published = isoDateToUnix(date);\n            }\n\n            var date_updated = isoDateToUnix(post.update());\n\n            return {\n\n                author: post.author().$id,\n                title: post.title(),\n                slug: post.slug(),\n                description: post.description(),\n                content: post.content(),\n                type: post.type(),\n                date_published: date_published,\n                date_updated: date_updated,\n                commenting: post.commenting(),\n                published: post.published(),\n                content_type: post.content_type(),\n                tags: tags === '' ? [] : tags.split(/\\, */),\n                language: post.language()\n            };\n        }\n    };\n\n    // Sets the view model values by the\n    // actual data object.\n\n    if (data) {\n\n        author = findAuthor(authors, data.author);\n\n        // When the publish date is set then\n        // set the date field to formatted string.\n\n        if (typeof data.date_published !== 'undefined') {\n\n            var d = new Date(data.date_published * 1000);\n\n            post.date(d.toISOString().substring(0, 10));\n        }\n\n        post.$id = data.$id;\n        post.author(author);\n        post.title(data.title);\n        post.slug(data.slug);\n        post.description(data.description || '');\n        post.content(data.content);\n        post.type(data.type);\n        post.content_type(data.content_type);\n        post.published(data.published);\n        post.commenting(data.commenting);\n        post.tags(data.tags.join(', '));\n        post.comments(data.comments);\n        post.language(data.language);\n\n    } else {\n\n        // Only when for new post.\n        // Add automatic slug generation.\n\n        post.title.subscribe(function(value) {\n\n            post.slug(getSlug(value));\n        });\n\n        // Default publish date.\n\n        post.date(new Date().toISOString().substring(0, 10));\n    }\n\n    // Default update date is the current date.\n\n    post.update(new Date().toISOString().substring(0, 10));\n\n    post.published.subscribe(function(value) {\n\n        // Set publish date when post is published.\n        // Applies only when no publish date is set.\n\n        if (value && post.date() === '') {\n\n            post.date(new Date().toISOString().substring(0, 10));\n        }\n    });\n\n    return post;\n};\n\n// Finds matching author from the\n// array of authors.\n\nfunction findAuthor(authors, id) {\n\n    var author;\n\n    for (var i = 0; i < authors.length; i++) {\n\n        if (authors[i].$id === id) {\n\n            author = authors[i];\n\n            break;\n        }\n    }\n\n    if (!author) {\n\n        throw new Error('No author ' + id);\n    }\n\n    return author;\n}\n\n// Converts ISO8601 date part into\n// an Unix timestamp.\n\nfunction isoDateToUnix(string) {\n\n    var match = string.match(/^(\\d{4})\\-(\\d{2})\\-(\\d{2})$/);\n\n    if (!match) {\n\n        throw new Error('Date does not match pattern: ' + string);\n    }\n\n    var date = new Date();\n\n    date.setUTCHours(0, 0, 0, 0);\n    date.setUTCFullYear(parseInt(match[1], 10), parseInt(match[2], 10) - 1, parseInt(match[3], 10));\n\n    return Math.floor(date.getTime() / 1000);\n}\n\n// Validates the given post.\n// Adds errors using the validate module.\n\nfunction validatePost(post) {\n\n    if (post.title() === '') {\n\n        validate.error('post-title', 'Title is not entered.');\n    }\n\n    var slug = post.slug();\n\n    if (slug === '') {\n\n        validate.error('post-slug', 'Slug is not entered.');\n\n    } else {\n\n        if (!slug.match(/^[a-z0-9\\-_]+$/)) {\n\n            validate.error('post-slug', 'Use lowercase letters, numbers, hyphen and underscore.');\n        }\n    }\n\n    if (post.content() === '') {\n\n        validate.error('post-content', 'Content is not entered.');\n    }\n\n    var date = post.date();\n\n    if (date === '') {\n\n        if (post.published()) {\n\n            validate.error('post-date', 'Publish date is not entered.');\n        }\n\n    } else if (!date.match(/^\\d{4}\\-\\d{2}\\-\\d{2}$/)) {\n\n        validate.error('post-date', 'Date must be in the YYYY-MM-DD format.');\n    }\n\n    var update = post.update();\n\n    if (update === '') {\n\n        validate.error('post-update', 'Update date is not entered.');\n\n    } else if (!update.match(/^\\d{4}\\-\\d{2}\\-\\d{2}$/)) {\n\n        validate.error('post-update', 'Update date must be in the YYYY-MM-DD format.');\n    }\n}\n\n// Handles save and\n// save-with-continue actions.\n\nfunction submitPost(post, edit) {\n\n    var form = document.getElementById('post');\n\n    validate.clear(form);\n\n    validatePost(post);\n\n    if (validate.hasError(form)) {\n\n        return false;\n    }\n\n    // When post has '$id' property\n    // then it's an existing post.\n\n    if (post.$id) {\n\n        updatePost(form, post, edit);\n\n    } else {\n\n        savePost(form, post, edit);\n    }\n}\n\n// Updates the already existing\n// post. Assumes that the post\n// is validated.\n\nfunction updatePost(form, post, edit) {\n\n    api.updatePost(post.$id, post.toJS()).then(function(response) {\n\n        if (response.status === 'success') {\n\n            message.info('Post updated.');\n\n            if (!edit) {\n\n                route.go(post.type() + 's');\n            }\n\n        } else {\n\n            validate.formError(form, response.message);\n\n            window.scroll(0, 0);\n        }\n\n    }, message.error);\n}\n\n// Saves the new post.\n\nfunction savePost(form, post, edit) {\n\n    api.savePost(post.toJS()).then(function(response) {\n\n        if (response.status === 'success') {\n\n            message.info('Post saved.');\n\n            // Redirect to post page when we\n            // want to keep editing the post.\n            // Otherwise go back to listing page.\n\n            if (edit) {\n\n                route.go(post.type() + '/' + response.data);\n\n            } else {\n\n                route.go(post.type() + 's');\n            }\n\n        } else {\n\n            validate.formError(form, response.message);\n\n            window.scroll(0, 0);\n        }\n\n    }, message.error);\n}\n","var api = require('../api');\nvar assign = require('../assign');\nvar message = require('../message');\nvar expandable = require('./expandable');\n\n// Creates user view model for\n// the users list view.\n\nexports.create = function(data) {\n\n    var user = {\n\n        editable: false\n    };\n\n    // Make it expandable.\n\n    expandable.mixin(user);\n\n    // Copies data attributes.\n\n    assign(user, data);\n\n    // Removes the user.\n    // Asks confirmation.\n\n    user.remove = function() {\n\n        if (confirm('Remove the user?')) {\n\n            api.removeUser(user.$id).then(function(response) {\n\n                if (response.status === 'success') {\n\n                    message.info('The user was removed.');\n\n                    route.refresh();\n\n                } else {\n\n                    message.error(response.message);\n                }\n\n            }).catch(message.error);\n        }\n    };\n\n    return user;\n};\n","// Sets focus to the given selector.\n\nmodule.exports = function(selector) {\n\n    var el = document.querySelector(selector);\n\n    if (el) {\n\n        el.focus();\n    }\n};\n","var message = require('../message');\nvar api = require('../api');\nvar validate = require('../validate');\n\n// info - the current user info.\n\nexports.create = function(info, data) {\n\n    var mytype = sessionStorage.getItem('user-type');\n\n    var user = {\n\n        username: ko.observable('').trimmed(),\n        fullname: ko.observable('').trimmed(),\n        type: ko.observable('author'),\n        link: ko.observable('').trimmed(),\n        password: ko.observable('').trimmed(),\n        password_edit: ko.observable(true),\n        password_text: ko.observable(false),\n        error: ko.observable(''),\n        creating: true,\n        files: ko.observable(false),\n        my_type: info.type,\n\n        save: function(form) {\n\n            validate.clear(form);\n\n            if (user.password_edit()) {\n\n                var password = user.password();\n\n                if (password === '') {\n\n                    validate.error('user-password', 'Password is not set.');\n\n                } else if (password.length < 6) {\n\n                    validate.error('user-password', 'Password length must be at least 6.');\n                }\n            }\n\n            var username = user.username();\n\n            if (username === '') {\n\n                validate.error('user-username', 'Username is not set.');\n\n            } else {\n\n                if (!username.match(/^[^@]+@[^@]+$/)) {\n\n                    validate.error('user-username', 'Username must be an email address.');\n                }\n            }\n\n            var fullname = user.fullname();\n\n            if (fullname === '') {\n\n                validate.error('user-fullname', 'Full name is not set.');\n            }\n\n            var link = user.link();\n\n            if (link !== '') {\n\n                if (!link.match(/https?:\\/\\//)) {\n\n                    validate.error('user-link', 'Link must start with http:// or https:// prefix.');\n                }\n            }\n\n            if (validate.hasError(form)) {\n\n                return false;\n            }\n\n            if (user.$id) {\n\n                api.updateUser(user.$id, user.toJS()).then(function(response) {\n\n                    if (response.status === 'success') {\n\n                        route.go('users');\n\n                    } else {\n\n                        validate.formError(form, response.message);\n                    }\n\n                }, message.error);\n\n            } else {\n\n                api.saveUser(user.toJS()).then(function(response) {\n\n                    if (response.status === 'success') {\n\n                        route.go('users');\n\n                    } else {\n\n                        validate.formError(form, response.message);\n                    }\n\n                }, message.error);\n            }\n\n            return false;\n        },\n\n        toJS: function() {\n\n            var js = {\n\n                username: user.username(),\n                fullname: user.fullname(),\n                type: user.type(),\n                link: user.link(),\n                files: user.files()\n            };\n\n            if (user.password_edit()) {\n\n                js.password = user.password();\n            }\n\n            return js;\n        }\n    };\n\n    user.password_text.subscribe(function(value) {\n\n        if (value) {\n\n            document.getElementById('user-password').type = 'text';\n\n        } else {\n\n            document.getElementById('user-password').type = 'password';\n        }\n    });\n\n    if (data) {\n\n        user.$id = data.$id;\n        user.creating = false;\n        user.username(data.username);\n        user.fullname(data.fullname);\n        user.type(data.type);\n        user.link(data.link);\n        user.password_edit(false);\n        user.files(data.files);\n    }\n\n    return user;\n};\n","var api = require('../api');\nvar assign = require('../assign');\nvar message = require('../message');\nvar expandable = require('./expandable');\n\n// View Model for a comment.\n\nexports.create = function(data) {\n\n    var comment = {};\n\n    // Make it expandable.\n\n    expandable.mixin(comment);\n\n    // Copies data attributes.\n\n    assign(comment, data);\n\n    comment.remove = function() {\n\n        if (confirm('Remove the comment?')) {\n\n            api.removeComment(comment.$id).then(function() {\n\n                route.refresh();\n\n            }).catch(message.error);\n        }\n    };\n\n    return comment;\n};\n","var hex = require('./hex');\n\n// Helper to work with hex-encoded file paths.\n\n// Decodes the given path into non-hex form.\n\nexports.decode = function(path) {\n\n    return hex.string(path);\n};\n\n// Returns hex-encoded parent directory.\n\nexports.parent = function(path) {\n\n    var decoded = hex.string(path);\n\n    if (decoded === '/') {\n\n        return path;\n    }\n\n    // Paths must start with slash.\n\n    if (decoded[0] !== '/') {\n\n        throw new Error('Paths must start with a slash.');\n    }\n\n    // Drop end slash.\n\n    if (decoded[decoded.lenght - 1] === '/') {\n\n        decoded = decoded.substring(0, decoded.lenght - 1);\n    }\n\n    var tokens = decoded.split(/\\//);\n\n    // Extract and encode the parent.\n\n    return hex.hex('/' + tokens.slice(1, tokens.length - 1).join('/'));\n};\n\n// Joins hex-encoded directory name with\n// non-encoded file name.\n\nexports.join = function(directory, name) {\n\n    var decoded = hex.string(directory);\n\n    // Does not add double slash when directory is /.\n\n    return hex.hex((decoded === '/' ? '' : decoded) + '/' + name);\n};\n","var api = require('../api');\nvar path = require('../path');\nvar assign = require('../assign');\nvar message = require('../message');\n\n// View Model for a directory entry.\n\nexports.create = function(directory, data) {\n\n    var entry = {};\n\n    // Copies data attributes.\n\n    assign(entry, data);\n\n    entry.encoded = path.join(directory, entry.name);\n\n    return entry;\n};\n\n// Compares entries so that directories\n// come first.\n\nexports.compare = function(entry1, entry2) {\n\n    // Compares directory entries by name.\n\n    function compareName() {\n\n        return entry1.name < entry2.name ? -1 : 1;\n    }\n\n    if (entry1.directory) {\n\n        if (entry2.directory) {\n\n            return compareName();\n\n        } else {\n\n            return -1;\n        }\n\n    } else {\n\n        if (entry2.directory) {\n\n            return 1;\n\n        } else {\n\n            return compareName();\n        }\n    }\n};\n","exports.show = function() {\n\n    document.getElementById('spinner').style.display = 'block';\n};\n\nexports.hide = function() {\n\n    document.getElementById('spinner').style.display = 'none';\n};\n","// Copies properties from one object to another.\n\nmodule.exports = function(to, from) {\n\n    Object.keys(from).forEach(function(key) {\n\n        to[key] = from[key];\n    });\n};\n","// Mixin for expandable view models.\n\nexports.mixin = function(obj) {\n\n    obj.expanded = ko.observable(false);\n\n    obj.expand = function() {\n\n        if (obj.expanded()) {\n\n            obj.expanded(false);\n\n        } else {\n\n            obj.expanded(true);\n        }\n    };\n};\n","// http://stackoverflow.com/questions/3217492/list-of-language-codes-in-yaml-or-json\n// @author Phil Teare\n// using wikipedia data\n\nmodule.exports = [\n    {\n        'code': 'ab',\n        'name': 'Abkhaz'\n    },\n    {\n        'code': 'aa',\n        'name': 'Afar'\n    },\n    {\n        'code': 'af',\n        'name': 'Afrikaans'\n    },\n    {\n        'code': 'ak',\n        'name': 'Akan'\n    },\n    {\n        'code': 'sq',\n        'name': 'Albanian'\n    },\n    {\n        'code': 'am',\n        'name': 'Amharic'\n    },\n    {\n        'code': 'ar',\n        'name': 'Arabic'\n    },\n    {\n        'code': 'an',\n        'name': 'Aragonese'\n    },\n    {\n        'code': 'hy',\n        'name': 'Armenian'\n    },\n    {\n        'code': 'as',\n        'name': 'Assamese'\n    },\n    {\n        'code': 'av',\n        'name': 'Avaric'\n    },\n    {\n        'code': 'ae',\n        'name': 'Avestan'\n    },\n    {\n        'code': 'ay',\n        'name': 'Aymara'\n    },\n    {\n        'code': 'az',\n        'name': 'Azerbaijani'\n    },\n    {\n        'code': 'bm',\n        'name': 'Bambara'\n    },\n    {\n        'code': 'ba',\n        'name': 'Bashkir'\n    },\n    {\n        'code': 'eu',\n        'name': 'Basque'\n    },\n    {\n        'code': 'be',\n        'name': 'Belarusian'\n    },\n    {\n        'code': 'bn',\n        'name': 'Bengali'\n    },\n    {\n        'code': 'bh',\n        'name': 'Bihari'\n    },\n    {\n        'code': 'bi',\n        'name': 'Bislama'\n    },\n    {\n        'code': 'bs',\n        'name': 'Bosnian'\n    },\n    {\n        'code': 'br',\n        'name': 'Breton'\n    },\n    {\n        'code': 'bg',\n        'name': 'Bulgarian'\n    },\n    {\n        'code': 'my',\n        'name': 'Burmese'\n    },\n    {\n        'code': 'ca',\n        'name': 'Catalan; Valencian'\n    },\n    {\n        'code': 'ch',\n        'name': 'Chamorro'\n    },\n    {\n        'code': 'ce',\n        'name': 'Chechen'\n    },\n    {\n        'code': 'ny',\n        'name': 'Chichewa; Chewa; Nyanja'\n    },\n    {\n        'code': 'zh',\n        'name': 'Chinese'\n    },\n    {\n        'code': 'cv',\n        'name': 'Chuvash'\n    },\n    {\n        'code': 'kw',\n        'name': 'Cornish'\n    },\n    {\n        'code': 'co',\n        'name': 'Corsican'\n    },\n    {\n        'code': 'cr',\n        'name': 'Cree'\n    },\n    {\n        'code': 'hr',\n        'name': 'Croatian'\n    },\n    {\n        'code': 'cs',\n        'name': 'Czech'\n    },\n    {\n        'code': 'da',\n        'name': 'Danish'\n    },\n    {\n        'code': 'dv',\n        'name': 'Divehi; Dhivehi; Maldivian;'\n    },\n    {\n        'code': 'nl',\n        'name': 'Dutch'\n    },\n    {\n        'code': 'en',\n        'name': 'English'\n    },\n    {\n        'code': 'eo',\n        'name': 'Esperanto'\n    },\n    {\n        'code': 'et',\n        'name': 'Estonian'\n    },\n    {\n        'code': 'ee',\n        'name': 'Ewe'\n    },\n    {\n        'code': 'fo',\n        'name': 'Faroese'\n    },\n    {\n        'code': 'fj',\n        'name': 'Fijian'\n    },\n    {\n        'code': 'fi',\n        'name': 'Finnish'\n    },\n    {\n        'code': 'fr',\n        'name': 'French'\n    },\n    {\n        'code': 'ff',\n        'name': 'Fula; Fulah; Pulaar; Pular'\n    },\n    {\n        'code': 'gl',\n        'name': 'Galician'\n    },\n    {\n        'code': 'ka',\n        'name': 'Georgian'\n    },\n    {\n        'code': 'de',\n        'name': 'German'\n    },\n    {\n        'code': 'el',\n        'name': 'Greek, Modern'\n    },\n    {\n        'code': 'gn',\n        'name': 'Guaraní'\n    },\n    {\n        'code': 'gu',\n        'name': 'Gujarati'\n    },\n    {\n        'code': 'ht',\n        'name': 'Haitian; Haitian Creole'\n    },\n    {\n        'code': 'ha',\n        'name': 'Hausa'\n    },\n    {\n        'code': 'he',\n        'name': 'Hebrew (modern)'\n    },\n    {\n        'code': 'hz',\n        'name': 'Herero'\n    },\n    {\n        'code': 'hi',\n        'name': 'Hindi'\n    },\n    {\n        'code': 'ho',\n        'name': 'Hiri Motu'\n    },\n    {\n        'code': 'hu',\n        'name': 'Hungarian'\n    },\n    {\n        'code': 'is',\n        'name': 'Icelandic'\n    },\n    {\n        'code': 'io',\n        'name': 'Ido'\n    },\n    {\n        'code': 'ig',\n        'name': 'Igbo'\n    },\n    {\n        'code': 'id',\n        'name': 'Indonesian'\n    },\n    {\n        'code': 'ia',\n        'name': 'Interlingua'\n    },\n    {\n        'code': 'ie',\n        'name': 'Interlingue'\n    },\n    {\n        'code': 'iu',\n        'name': 'Inuktitut'\n    },\n    {\n        'code': 'ik',\n        'name': 'Inupiaq'\n    },\n    {\n        'code': 'ga',\n        'name': 'Irish'\n    },\n    {\n        'code': 'it',\n        'name': 'Italian'\n    },\n    {\n        'code': 'ja',\n        'name': 'Japanese'\n    },\n    {\n        'code': 'jv',\n        'name': 'Javanese'\n    },\n    {\n        'code': 'kl',\n        'name': 'Kalaallisut, Greenlandic'\n    },\n    {\n        'code': 'kn',\n        'name': 'Kannada'\n    },\n    {\n        'code': 'kr',\n        'name': 'Kanuri'\n    },\n    {\n        'code': 'ks',\n        'name': 'Kashmiri'\n    },\n    {\n        'code': 'kk',\n        'name': 'Kazakh'\n    },\n    {\n        'code': 'km',\n        'name': 'Khmer'\n    },\n    {\n        'code': 'ki',\n        'name': 'Kikuyu, Gikuyu'\n    },\n    {\n        'code': 'rw',\n        'name': 'Kinyarwanda'\n    },\n    {\n        'code': 'ky',\n        'name': 'Kirghiz, Kyrgyz'\n    },\n    {\n        'code': 'rn',\n        'name': 'Kirundi'\n    },\n    {\n        'code': 'kv',\n        'name': 'Komi'\n    },\n    {\n        'code': 'kg',\n        'name': 'Kongo'\n    },\n    {\n        'code': 'ko',\n        'name': 'Korean'\n    },\n    {\n        'code': 'ku',\n        'name': 'Kurdish'\n    },\n    {\n        'code': 'kj',\n        'name': 'Kwanyama, Kuanyama'\n    },\n    {\n        'code': 'lo',\n        'name': 'Lao'\n    },\n    {\n        'code': 'la',\n        'name': 'Latin'\n    },\n    {\n        'code': 'lv',\n        'name': 'Latvian'\n    },\n    {\n        'code': 'li',\n        'name': 'Limburgish, Limburgan, Limburger'\n    },\n    {\n        'code': 'ln',\n        'name': 'Lingala'\n    },\n    {\n        'code': 'lt',\n        'name': 'Lithuanian'\n    },\n    {\n        'code': 'lu',\n        'name': 'Luba-Katanga'\n    },\n    {\n        'code': 'lg',\n        'name': 'Luganda'\n    },\n    {\n        'code': 'lb',\n        'name': 'Luxembourgish, Letzeburgesch'\n    },\n    {\n        'code': 'mk',\n        'name': 'Macedonian'\n    },\n    {\n        'code': 'mg',\n        'name': 'Malagasy'\n    },\n    {\n        'code': 'ms',\n        'name': 'Malay'\n    },\n    {\n        'code': 'ml',\n        'name': 'Malayalam'\n    },\n    {\n        'code': 'mt',\n        'name': 'Maltese'\n    },\n    {\n        'code': 'gv',\n        'name': 'Manx'\n    },\n    {\n        'code': 'mr',\n        'name': 'Marathi (Marāṭhī)'\n    },\n    {\n        'code': 'mh',\n        'name': 'Marshallese'\n    },\n    {\n        'code': 'mn',\n        'name': 'Mongolian'\n    },\n    {\n        'code': 'mi',\n        'name': 'Māori'\n    },\n    {\n        'code': 'na',\n        'name': 'Nauru'\n    },\n    {\n        'code': 'nv',\n        'name': 'Navajo, Navaho'\n    },\n    {\n        'code': 'ng',\n        'name': 'Ndonga'\n    },\n    {\n        'code': 'ne',\n        'name': 'Nepali'\n    },\n    {\n        'code': 'nd',\n        'name': 'North Ndebele'\n    },\n    {\n        'code': 'se',\n        'name': 'Northern Sami'\n    },\n    {\n        'code': 'no',\n        'name': 'Norwegian'\n    },\n    {\n        'code': 'nb',\n        'name': 'Norwegian Bokmål'\n    },\n    {\n        'code': 'nn',\n        'name': 'Norwegian Nynorsk'\n    },\n    {\n        'code': 'ii',\n        'name': 'Nuosu'\n    },\n    {\n        'code': 'oc',\n        'name': 'Occitan'\n    },\n    {\n        'code': 'oj',\n        'name': 'Ojibwe, Ojibwa'\n    },\n    {\n        'code': 'cu',\n        'name': 'Old Church Slavonic, Church Slavic, Church Slavonic, Old Bulgarian, Old Slavonic'\n    },\n    {\n        'code': 'or',\n        'name': 'Oriya'\n    },\n    {\n        'code': 'om',\n        'name': 'Oromo'\n    },\n    {\n        'code': 'os',\n        'name': 'Ossetian, Ossetic'\n    },\n    {\n        'code': 'pa',\n        'name': 'Panjabi, Punjabi'\n    },\n    {\n        'code': 'ps',\n        'name': 'Pashto, Pushto'\n    },\n    {\n        'code': 'fa',\n        'name': 'Persian'\n    },\n    {\n        'code': 'pl',\n        'name': 'Polish'\n    },\n    {\n        'code': 'pt',\n        'name': 'Portuguese'\n    },\n    {\n        'code': 'pi',\n        'name': 'Pāli'\n    },\n    {\n        'code': 'qu',\n        'name': 'Quechua'\n    },\n    {\n        'code': 'ro',\n        'name': 'Romanian, Moldavian, Moldovan'\n    },\n    {\n        'code': 'rm',\n        'name': 'Romansh'\n    },\n    {\n        'code': 'ru',\n        'name': 'Russian'\n    },\n    {\n        'code': 'sm',\n        'name': 'Samoan'\n    },\n    {\n        'code': 'sg',\n        'name': 'Sango'\n    },\n    {\n        'code': 'sa',\n        'name': 'Sanskrit (Saṁskṛta)'\n    },\n    {\n        'code': 'sc',\n        'name': 'Sardinian'\n    },\n    {\n        'code': 'gd',\n        'name': 'Scottish Gaelic; Gaelic'\n    },\n    {\n        'code': 'sr',\n        'name': 'Serbian'\n    },\n    {\n        'code': 'sn',\n        'name': 'Shona'\n    },\n    {\n        'code': 'sd',\n        'name': 'Sindhi'\n    },\n    {\n        'code': 'si',\n        'name': 'Sinhala, Sinhalese'\n    },\n    {\n        'code': 'sk',\n        'name': 'Slovak'\n    },\n    {\n        'code': 'sl',\n        'name': 'Slovene'\n    },\n    {\n        'code': 'so',\n        'name': 'Somali'\n    },\n    {\n        'code': 'nr',\n        'name': 'South Ndebele'\n    },\n    {\n        'code': 'st',\n        'name': 'Southern Sotho'\n    },\n    {\n        'code': 'es',\n        'name': 'Spanish; Castilian'\n    },\n    {\n        'code': 'su',\n        'name': 'Sundanese'\n    },\n    {\n        'code': 'sw',\n        'name': 'Swahili'\n    },\n    {\n        'code': 'ss',\n        'name': 'Swati'\n    },\n    {\n        'code': 'sv',\n        'name': 'Swedish'\n    },\n    {\n        'code': 'tl',\n        'name': 'Tagalog'\n    },\n    {\n        'code': 'ty',\n        'name': 'Tahitian'\n    },\n    {\n        'code': 'tg',\n        'name': 'Tajik'\n    },\n    {\n        'code': 'ta',\n        'name': 'Tamil'\n    },\n    {\n        'code': 'tt',\n        'name': 'Tatar'\n    },\n    {\n        'code': 'te',\n        'name': 'Telugu'\n    },\n    {\n        'code': 'th',\n        'name': 'Thai'\n    },\n    {\n        'code': 'bo',\n        'name': 'Tibetan Standard, Tibetan, Central'\n    },\n    {\n        'code': 'ti',\n        'name': 'Tigrinya'\n    },\n    {\n        'code': 'to',\n        'name': 'Tonga (Tonga Islands)'\n    },\n    {\n        'code': 'ts',\n        'name': 'Tsonga'\n    },\n    {\n        'code': 'tn',\n        'name': 'Tswana'\n    },\n    {\n        'code': 'tr',\n        'name': 'Turkish'\n    },\n    {\n        'code': 'tk',\n        'name': 'Turkmen'\n    },\n    {\n        'code': 'tw',\n        'name': 'Twi'\n    },\n    {\n        'code': 'ug',\n        'name': 'Uighur, Uyghur'\n    },\n    {\n        'code': 'uk',\n        'name': 'Ukrainian'\n    },\n    {\n        'code': 'ur',\n        'name': 'Urdu'\n    },\n    {\n        'code': 'uz',\n        'name': 'Uzbek'\n    },\n    {\n        'code': 've',\n        'name': 'Venda'\n    },\n    {\n        'code': 'vi',\n        'name': 'Vietnamese'\n    },\n    {\n        'code': 'vo',\n        'name': 'Volapük'\n    },\n    {\n        'code': 'wa',\n        'name': 'Walloon'\n    },\n    {\n        'code': 'cy',\n        'name': 'Welsh'\n    },\n    {\n        'code': 'fy',\n        'name': 'Western Frisian'\n    },\n    {\n        'code': 'wo',\n        'name': 'Wolof'\n    },\n    {\n        'code': 'xh',\n        'name': 'Xhosa'\n    },\n    {\n        'code': 'yi',\n        'name': 'Yiddish'\n    },\n    {\n        'code': 'yo',\n        'name': 'Yoruba'\n    },\n    {\n        'code': 'za',\n        'name': 'Zhuang, Chuang'\n    }\n];\n"]}